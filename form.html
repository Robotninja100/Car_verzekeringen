<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uitgebreid Offerteformulier Tijdelijke CAR-Verzekering (Multi-Step) | OnlineCARverzekeringen.nl</title>
    <style>
        /* ... (ALLE CSS BLIJFT HETZELFDE ALS IN DE VORIGE VERSIE) ... */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap');

        :root {
            /* Variabelen van car_site.html (gebruikt door header) */
            --primary-color: #0A2463; /* Diep Blauw */
            --secondary-color: #3E92CC; /* Medium Blauw */
            --accent-color: #FFC947; /* Geel/Goud */
            --light-accent-color: #FFEEB8; /* Licht Geel */
            --text-color: #333333;
            --light-text-color: #FFFFFF;
            --background-color: #FFFFFF; /* Gebruikt door header achtergrond */
            --light-gray-color: #F4F4F8;
            --border-color: #DDDDDD;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            --box-shadow-hover: 0 6px 20px rgba(0, 0, 0, 0.12);
            --box-shadow-strong: 0 8px 25px rgba(0, 0, 0, 0.15);
            --border-radius: 10px;
            --transition-speed: 0.3s;
            --transition-speed-fast: 0.2s;

            /* Variabelen specifiek voor Offerte.html formulier */
            --form-bg-color: #ffffff;
            --form-border-color: #d1d5db;
            --form-focus-border-color: #3b82f6;
            --form-text-color: #1f2937;
            --form-label-color: #374151;
            --form-section-bg-color: #f9fafb;
            --form-button-bg-color: #2563eb;
            --form-button-hover-bg-color: #1d4ed8;
            --form-button-secondary-bg-color: #6b7280;
            --form-button-secondary-hover-bg-color: #4b5563;
            --form-button-text-color: #ffffff;
            --danger-color: #dc2626;
            --progress-bar-bg: #e5e7eb;
            --progress-bar-fill: #3b82f6;
            --progress-step-active-bg: #3b82f6;
            --progress-step-inactive-bg: #9ca3af;
            --progress-step-text-color: #ffffff;
            --conditional-bg-color: rgba(59, 130, 246, 0.03);
            --conditional-border-color: rgba(59, 130, 246, 0.3);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Open Sans', sans-serif; /* Default font for form page */
            background-color: #e5e7eb; /* Page background for form area */
            color: var(--form-text-color); /* Default text color for form elements */
            line-height: 1.6;
            /* padding: 20px; */ /* Verwijderd voor full-width header */
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden; /* Voorkom horizontale scrollbars */
        }

        /* Header Styles (from car_site.html) */
        header#mainHeader { /* Specific selector for offerte page header */
            font-family: 'Poppins', sans-serif; /* Ensure header uses Poppins */
            background-color: var(--background-color);
            padding: 1rem 0;
            border-bottom: 1px solid transparent;
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%; /* Ensure full width */
            transition: box-shadow var(--transition-speed) ease, border-color var(--transition-speed) ease;
        }

        header#mainHeader.scrolled {
            box-shadow: var(--box-shadow);
            border-bottom: 1px solid var(--border-color);
        }

        /* Container for header content */
        header#mainHeader .container {
            width: 90%;
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.9rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            letter-spacing: -1px;
        }

        header#mainHeader nav ul {
            list-style: none;
            display: flex;
        }

        header#mainHeader nav ul li {
            margin-left: 30px;
        }

        header#mainHeader nav ul li a {
            text-decoration: none;
            color: var(--primary-color);
            font-weight: 500;
            padding: 8px 0px;
            position: relative;
            transition: color var(--transition-speed-fast) ease;
        }

        header#mainHeader nav ul li a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -4px;
            left: 0;
            background-color: var(--accent-color);
            transition: width var(--transition-speed) ease;
        }

        header#mainHeader nav ul li a:hover,
        header#mainHeader nav ul li a.active {
            color: var(--secondary-color);
            font-weight: 600;
        }
        header#mainHeader nav ul li a:hover::after,
        header#mainHeader nav ul li a.active::after {
            width: 100%;
        }
        /* End of Header Styles */


        .form-container {
            background-color: var(--form-bg-color);
            padding: 20px 30px 30px 30px;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            /* margin-top: 20px; */ /* Wordt nu geregeld door progress-bar-container margin */
        }

        .form-container h1 {
            text-align: center; color: var(--form-text-color);
            margin-bottom: 10px; font-size: 1.7rem;
        }
        .form-container .form-intro {
            text-align: center; color: var(--form-label-color);
            margin-bottom: 25px; font-size: 0.9rem;
        }

        /* Progress Bar Styling */
        .progress-bar-container {
            width: 100%; max-width: 900px; margin-bottom: 20px;
            background-color: var(--form-bg-color); padding: 15px 20px;
            border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            margin-top: 20px; /* Added margin to clear sticky header, adjust if header height changes */
        }
        .progress-bar {
            display: flex; justify-content: space-between; align-items: center;
            position: relative; height: 30px;
        }
        .progress-bar::before {
            content: ''; position: absolute; top: 50%; left: 0;
            transform: translateY(-50%); height: 4px; width: 100%;
            background-color: var(--progress-bar-bg); z-index: 1;
        }
        .progress-line {
            position: absolute; top: 50%; left: 0; transform: translateY(-50%);
            height: 4px; background-color: var(--progress-bar-fill); z-index: 2;
            width: 0%; transition: width 0.4s ease;
        }
        .progress-step {
            width: 30px; height: 30px; background-color: var(--progress-step-inactive-bg);
            color: var(--progress-step-text-color); border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 0.9rem; z-index: 3; position: relative;
            border: 3px solid var(--form-bg-color); transition: background-color 0.4s ease, transform 0.3s ease;
        }
        .progress-step.active {
            background-color: var(--progress-step-active-bg); transform: scale(1.15);
        }
        .progress-step.completed {
             background-color: var(--progress-bar-fill);
             border-color: var(--progress-bar-fill);
        }
        .progress-step.completed::after {
            content: '\2713';
            font-size: 1.1rem;
            color: white;
        }

        .progress-step span.tooltip-text {
            visibility: hidden; width: 140px; background-color: #333; color: #fff;
            text-align: center; border-radius: 6px; padding: 6px 0;
            position: absolute; z-index: 4; bottom: 130%; left: 50%;
            margin-left: -70px; opacity: 0; transition: opacity 0.3s; font-size: 0.8rem;
        }
        .progress-step:hover span.tooltip-text { visibility: visible; opacity: 1; }
        .progress-step .step-number {
             display: inline-block;
        }
        .progress-step.completed .step-number {
            display: none;
        }


        fieldset.form-step {
            border: none;
            padding: 15px 5px 5px 5px;
            margin-bottom: 0;
            background-color: var(--form-bg-color);
            display: none;
            position: relative; /* Kan blijven, schaadt niet als help-tips inline zijn */
        }
        fieldset.form-step.active { display: block; animation: fadeInStep 0.5s ease-in-out; }
        @keyframes fadeInStep {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        legend {
            font-size: 1.4rem; font-weight: 700; color: var(--form-text-color);
            padding: 0; margin-bottom: 20px; width: 100%;
            border-bottom: 2px solid var(--form-focus-border-color); padding-bottom: 8px;
        }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; font-weight: 600; color: var(--form-label-color);
            margin-bottom: 8px; font-size: 0.9rem;
        }
        .form-group label.radio-label, .form-group label.checkbox-label {
            display: inline-block; font-weight: normal; margin-right: 12px;
            margin-bottom: 0; margin-left: 4px; font-size: 0.95rem;
        }
        .input-group { display: flex; align-items: center; }
        .input-group .currency-symbol, .input-group .unit-symbol {
            padding: 10px 12px; background-color: #e9ecef;
            border: 1px solid var(--form-border-color); border-right: none;
            border-radius: 4px 0 0 4px; color: var(--form-label-color); font-size:0.9rem;
        }
        .input-group input[type="text"], .input-group input[type="number"] {
            border-radius: 0 4px 4px 0 !important;
        }

        input[type="text"], input[type="email"], input[type="tel"],
        input[type="date"], input[type="number"], select, textarea {
            width: 100%; padding: 10px 12px;
            border: 1px solid var(--form-border-color); border-radius: 5px;
            font-size: 0.95rem; color: var(--form-text-color);
            background-color: #fff;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        input:focus, select:focus, textarea:focus {
            outline: none; border-color: var(--form-focus-border-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        input:disabled, select:disabled, textarea:disabled {
            background-color: #e9ecef; /* Bootstrap's disabled color */
            opacity: 0.7;
            cursor: not-allowed;
        }

        textarea { min-height: 75px; resize: vertical; }
        .radio-group, .checkbox-group { display: flex; flex-wrap: wrap; gap: 8px 18px; }
        .radio-group div, .checkbox-group div { display: flex; align-items: center; }
        input[type="radio"], input[type="checkbox"] {
            margin-right: 6px; accent-color: var(--form-focus-border-color);
            width: 16px; height: 16px;
        }
        .conditional-section {
            display: none; padding: 15px; margin-top: 15px; margin-bottom:15px;
            border-left: 4px solid var(--conditional-border-color);
            background-color: var(--conditional-bg-color);
            border-radius: 0 6px 6px 0;
        }
        .conditional-section .form-group:last-child { margin-bottom: 0; }

        .form-navigation-buttons {
            display: flex; justify-content: space-between; margin-top: 30px;
            padding-top:20px; border-top: 1px solid #eee;
        }
        .nav-button {
            padding: 11px 22px; border: none; border-radius: 6px; font-size: 1rem;
            font-weight: 600; cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
            color: var(--form-button-text-color);
        }
        .nav-button:active { transform: scale(0.98); }
        .next-button { background-color: var(--form-button-bg-color); }
        .next-button:hover { background-color: var(--form-button-hover-bg-color); }
        .prev-button { background-color: var(--form-button-secondary-bg-color); }
        .prev-button:hover { background-color: var(--form-button-secondary-hover-bg-color); }
        .submit-button { background-color: var(--form-button-bg-color); }
        .submit-button:hover { background-color: var(--form-button-hover-bg-color); }
        
        /* --- START NIEUWE CSS VOOR OPSLAAN KNOP --- */
        .save-button {
            background-color: #6c757d; /* Een neutrale grijze kleur */
            flex-grow: 0; /* Voorkom dat deze knop meegroeit */
        }
        .save-button:hover {
            background-color: #5a6268;
        }
        .save-button:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        /* --- EINDE NIEUWE CSS --- */

        .ubo-section {
            padding-bottom: 10px; /* Space before buttons or hr */
        }
        .ubo-section h4 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--form-text-color);
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--form-border-color);
        }
        .remove-ubo-button {
            background-color: #db1919;
            color: whitesmoke; padding: 8px 16px; border-radius: 5px;
            font-size: 0.9rem; font-weight: 600; cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
            border: none; /* Ensure no default border */
            margin-top: 10px; /* Add some space if multiple buttons appear */
        }

        .remove-ubo-button:active { transform: scale(0.98); }
        .remove-ubo-button:hover { background-color: #b01010; } /* Darker red on hover */

        /* Aannemer Section Styles (nieuw) */
        .aannemer-section {
            padding: 20px;
            margin-bottom: 20px; /* Ruimte tussen aannemer blokken */
            border: 1px solid var(--form-border-color);
            border-radius: var(--border-radius);
            background-color: var(--form-section-bg-color); /* Lichtgrijze achtergrond voor het blok */
        }
        .aannemer-section h4 {
            font-size: 1.15rem; /* Iets kleiner dan UBO h4 voor hiërarchie */
            font-weight: 700;
            color: var(--form-text-color);
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--form-border-color);
        }
        .remove-aannemer-button { /* Hergebruik stijl van UBO verwijder knop of definieer apart */
            background-color: #db1919; /* Rode kleur */
            color: white; padding: 8px 16px; border-radius: 5px;
            font-size: 0.9rem; font-weight: 600; cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease;
            border: none;
            margin-top: 10px;
        }
        .remove-aannemer-button:hover { background-color: #b01010; } /* Donkerder rood */
        /* Optioneel: styling voor de container van alle aannemer formulieren */
        #aannemer-forms-container {
            margin-bottom: 15px; /* Ruimte voor de "Aannemer toevoegen" knop */
        }



        .form-row { display: flex; gap: 20px; }
        .form-row .form-group { flex: 1; }
        .asterisk { color: var(--danger-color); font-weight: bold; margin-left: 2px;}
        small.help-text { display: block; font-size: 0.8rem; color: #6c757d; margin-top: 4px; }
        /* Styling for "Anders" waarschuwing, similar to .help-text or .duurBouwWaarschuwing */
        .anders-waarschuwing {
            color: #777; font-size: 0.9em; margin-top: 5px; display: none;
        }


        /* Styles for "Anders, namelijk" text input */
        .inline-text-input {
            display: none; /* Default hidden, JS will add 'visible' class */
            width: auto; /* Desktop: allow it to take space based on flex-grow */
            margin-left: 8px;
            flex-grow: 1;
        }
        .inline-text-input.visible { /* JS adds this class to show the input */
            display: inline-block; /* Desktop visible style */
        }

        .cta-button {
            display: inline-block;
            background-color: var(--accent-color);
            color: var(--primary-color);
            padding: 16px 38px; /* Iets groter */
            text-decoration: none;
            font-size: 1.15rem;
            font-weight: 600;
            border-radius: var(--border-radius);
            transition: background-color var(--transition-speed) ease, transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
            box-shadow: var(--box-shadow);
            /* animation: fadeInUpCustom 1s ease-out 0.8s; */ /* Kan storend zijn bij dynamisch toevoegen */
            /* animation-fill-mode: backwards; */
            position: relative;
            overflow: hidden;
            border: none; /* Ensure no default border */
        }
        .cta-button::before { /* Shine effect */
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.7s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .cta-button:hover {
            background-color: #e6b840;
            transform: translateY(-4px) scale(1.02); /* Meer beweging */
            box-shadow: var(--box-shadow-hover);
        }
        .cta-button:hover::before {
            left: 100%;
        }

        /* --- START AANGEPASTE CSS VOOR INLINE HELP TIP --- */
        .help-tip {
            display: inline-block; 
            vertical-align: middle; 
            margin-left: 5px;      
            position: relative;    
            width: 20px;
            height: 20px;
            line-height: 20px; 
            font-size: 12px;  
            background-color: #BCDBEA; 
            border-radius: 50%;
            text-align: center;
            font-weight: bold;
            color: #fff;
            cursor: default;
            z-index: 90; 
        }

        .help-tip:before { 
            content: '?';
        }

        .help-tip p { 
            display: none; 
            position: absolute; 
            width: 280px; 
            padding: 15px;
            background-color: #1E2021;
            color: #FFF;
            text-align: left;
            font-size: 12px; 
            line-height: 1.4;
            border-radius: 3px;
            box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.2);
            z-index: 100; 
            top: calc(100% + 8px); 
            left: 50%;
            transform: translateX(-50%); 
        }

        .help-tip p:before { 
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 6px 6px 6px; 
            border-color: transparent transparent #1E2021 transparent; 
            top: -6px; 
            left: 50%;
            transform: translateX(-50%); 
        }

        .help-tip:hover p {
            display: block;
            transform-origin: 50% 0; 
            animation: fadeInTooltipAnimation 0.3s ease-in-out;
            -webkit-animation: fadeInTooltipAnimation 0.3s ease-in-out;
        }

        .help-tip p:after { 
            content: '';
            position: absolute;
            width: 100%;
            height: 28px; 
            top: -28px; 
            left: 0;
        }

        

        @keyframes fadeInTooltipAnimation {
            0% {
                opacity: 0;
                transform: scale(0.8) translateX(-50%); 
            }
            100% {
                opacity: 1;
                transform: scale(1) translateX(-50%); 
            }
        }
        @-webkit-keyframes fadeInTooltipAnimation { 
            0% {
                opacity: 0;
                transform: scale(0.8) translateX(-50%);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateX(-50%);
            }
        }
        /* --- EINDE AANGEPASTE CSS VOOR INLINE HELP TIP --- */


        @keyframes fadeInDownCustom {
            from { opacity: 0; transform: translateY(-40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUpCustom {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* --- START CSS VOOR DISCLAIMER SECTIE --- */ /* NIEUW */
        .form-disclaimer {
            margin-top: 30px; 
            padding: 20px;
            border: 1px solid var(--form-border-color); 
            border-radius: var(--border-radius);
            background-color: var(--form-section-bg-color); 
            text-align: left;
        }

        .form-disclaimer h2 {
            font-size: 1.4rem; 
            color: var(--form-text-color);
            margin-bottom: 15px;
            text-align: center; 
        }

        .form-disclaimer h3 {
            font-size: 1.1rem;
            color: var(--form-label-color);
            margin-top: 15px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-disclaimer p {
            font-size: 0.9rem;
            color: var(--form-text-color); 
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .form-disclaimer ul {
            list-style-type: disc; 
            margin-left: 20px; 
            margin-bottom: 15px;
        }

        .form-disclaimer ul li {
            font-size: 0.9rem;
            color: var(--form-text-color);
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .form-disclaimer ul li strong {
            font-weight: 600;
            color: var(--form-label-color);
        }
        /* --- EINDE CSS VOOR DISCLAIMER SECTIE --- */


        /* --- START CSS VOOR CONTACT FOOTER --- */ 
        .form-contact-footer {
            margin-top: 40px; /* Space above this section */
            padding-top: 25px;
            border-top: 1px solid var(--form-border-color);
            text-align: center;
        }

        .form-contact-footer h2 {
            font-size: 1.5rem; /* Slightly smaller than main H1 */
            color: var(--form-text-color);
            margin-bottom: 10px;
        }

        .form-contact-footer p { /* General paragraph in contact footer */
            font-size: 0.95rem;
            color: var(--form-label-color);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .form-contact-footer .contact-details {
            margin-top: 20px;
        }

        .form-contact-footer .contact-item {
            font-size: 1rem;
            color: var(--form-text-color);
            margin-bottom: 8px; /* Specific margin for items like email/phone lines */
        }

        .form-contact-footer .contact-item a {
            color: var(--form-button-bg-color); /* Using button color for links */
            text-decoration: none;
            font-weight: 600;
        }

        .form-contact-footer .contact-item a:hover {
            text-decoration: underline;
            color: var(--form-button-hover-bg-color);
        }
        /* --- EINDE CSS VOOR CONTACT FOOTER --- */


        @media (max-width: 768px) {
    /* ... (jouw bestaande mobiele stijlen voor .form-container, legend, etc. blijven) ... */

    /* Responsive Header Styles - NU MET HAMBURGER MENU */
        header#mainHeader .container {
            flex-direction: row; /* Logo en hamburger naast elkaar */
            justify-content: space-between; /* Logo links, hamburger rechts */
            align-items: center;
            position: relative; /* Nodig voor positionering van het uitklapmenu */
        }

        .logo {
            font-size: 1.6rem;
            margin-bottom: 0; /* Niet meer nodig als het naast de knop staat */
            z-index: 1101; /* Zorg dat logo boven uitgeklapt menu blijft */
        }

        .menu-toggle {
            display: block; /* Toon de hamburger knop op mobiel */
            /* Styles for hamburger icon (three bars) */
            width: 30px; height: 22px; position: relative; cursor: pointer;
            background: none; border: none;
            padding: 0;
        }
        .menu-toggle span {
            display: block; position: absolute; height: 3px; width: 100%;
            background: var(--primary-color); border-radius: 3px;
            opacity: 1; left: 0;
            transform: rotate(0deg);
            transition: .25s ease-in-out;
        }
        .menu-toggle span:nth-child(1) { top: 0px; }
        .menu-toggle span:nth-child(2) { top: 9px; } /* (22 - 3*3) / 2 = 6.5, aangepast naar 9 en 18 voor spacing */
        .menu-toggle span:nth-child(3) { top: 18px; } /* 18 ipv 22-3=19 */

        /* Stijlen voor geanimeerde hamburger naar 'X' */
        .menu-toggle.active span:nth-child(1) {
            transform: translateY(8px) rotate(45deg); /* Aangepast van 8px */
        }
        .menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }
        .menu-toggle.active span:nth-child(3) {
            transform: translateY(-8px) rotate(-45deg); /* Aangepast van -8px */
        }

        /* Navigatie menu zelf op mobiel */
        header#mainHeader nav {
            position: absolute;
            top: 100%; /* Direct onder de header */
            left: 0;
            width: 100%;
            background-color: var(--background-color); /* Gebruik achtergrond van header */
            box-shadow: var(--box-shadow);
            max-height: 0; /* Initieel verborgen */
            overflow: hidden;
            transition: max-height 0.4s ease-out;
            z-index: 1050; /* Onder logo/toggle, boven pagina content */
        }

        header#mainHeader nav.menu-open {
            max-height: calc(100vh - 60px); /* Max hoogte, bijv. viewport - header hoogte. Pas 60px evt. aan aan je header hoogte */
            overflow-y: auto; /* Scrollbaar indien nodig */
        }

        header#mainHeader nav ul {
            flex-direction: column;
            margin-top: 0; /* Reset margin */
            width: 100%;
            padding: 10px 0; /* Padding binnen het geopende menu */
        }

        header#mainHeader nav ul li {
            margin: 0; /* Reset individuele item margin */
            margin-left: 0; /* Zorg dat dit gereset is */
            text-align: center;
        }

        header#mainHeader nav ul li a {
            display: block;
            padding: 15px 20px; /* Grotere klikgebieden */
            border-bottom: 1px solid var(--light-gray-color); /* Lijn tussen items */
        }
        header#mainHeader nav ul li:last-child a {
            border-bottom: none; /* Geen lijn voor laatste item */
        }

        header#mainHeader nav ul li a::after {
            left: 50%;
            transform: translateX(-50%);
            bottom: 10px; /* Aanpassen aan nieuwe padding */
        }

        /* ... (de rest van je bestaande mobiele stijlen voor het formulier) ... */
    }

    /* Als body.menu-is-open, voorkom scrollen van de pagina achter het menu */
    body.menu-is-open {
        overflow: hidden;
    }
    </style>
</head>
<body>
    <header id="mainHeader">
        <div class="container">
            <a href="car_site.html#hero" class="logo">OnlineCARverzekeringen.nl</a>
            <button class="menu-toggle" aria-label="Menu openen/sluiten" aria-expanded="false" aria-controls="mainNavMenuForm">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <nav id="mainNavMenuForm">
                <ul>
                    <li><a href="car_site.html#hero">Home</a></li>
                    <li><a href="car_site.html#informatie">Informatie</a></li>
                    <li><a href="car_site.html#diensten">Diensten</a></li>
                    <li><a href="car_site.html#offerte-cta" class="active">Offerte</a></li>
                    <li><a href="car_site.html#contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar">
            <div class="progress-line" id="progressLine"></div>
            <!-- Steps dynamically inserted here -->
        </div>
    </div>

    <div class="form-container">
        <h1>Offerte Tijdelijke CAR-Verzekering</h1>
        <p class="form-intro">Volg de stappen om uw offerte aan te vragen. Velden met een <span class="asterisk">*</span> zijn verplicht.</p>

        <form id="carOfferteForm" action="https://formsubmit.co/robotninja100@gmail.com" method="POST">
            <input type="hidden" name="_next" value="https://robotninja100.github.io/Car_verzekeringen/bedankt.html">

            <!-- Stap 1: Aanvragergegevens -->
            <fieldset class="form-step active" data-step-name="Aanvrager">
                <legend>1. Aanvragergegevens</legend>

                <div class="form-group">
                    <label>Type aanvrager<span class="asterisk">*</span></label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="aanvragerTypeZakelijk" name="aanvragerType" value="zakelijk" onclick="toggleAanvragerType('zakelijk')">
                            <label for="aanvragerTypeZakelijk" class="radio-label">Zakelijk</label>
                        </div>
                        <div>
                            <input type="radio" id="aanvragerTypeParticulier" name="aanvragerType" value="particulier" onclick="toggleAanvragerType('particulier')">
                            <label for="aanvragerTypeParticulier" class="radio-label">Particulier</label>
                        </div>
                    </div>
                </div>

                <!-- Zakelijke Velden Container -->
                <div id="zakelijkFieldsContainer" style="display: none;">
                    <div class="form-group">
                        <label for="kvkNummer">KVK-nummer<span class="asterisk">*</span>
                            <span class="help-tip">
                                <p>Vul hier uw Kamer van Koophandel nummer in. Dit nummer bestaat uit 9 cijfers.</p>
                            </span>
                        </label>
                        <input type="text" id="kvkNummer" name="kvkNummer" maxlength="9" pattern="\d{8}" title="Vul een geldig KVK-nummer in (8 cijfers)">
                    </div>
                    <div class="form-group">
                        <label for="bedrijfsnaamZakelijk">Bedrijfsnaam<span class="asterisk">*</span></label>
                        <input type="text" id="bedrijfsnaamZakelijk" name="bedrijfsnaamZakelijk">
                    </div>
                    <div class="form-group">
                        <label for="handelsnaamZakelijk">Handelsnaam (optioneel)</label>
                        <input type="text" id="handelsnaamZakelijk" name="handelsnaamZakelijk">
                    </div>
                    <div class="form-group">
                        <label for="rechtsvorm">Rechtsvorm<span class="asterisk">*</span></label>
                        <select id="rechtsvorm" name="rechtsvorm">
                            <option value="">Kies een rechtsvorm</option>
                            <option value="eenmanszaak">Eenmanszaak</option>
                            <option value="bv">Besloten Vennootschap (B.V.)</option>
                            <option value="vof">Vennootschap onder firma (V.O.F.)</option>
                            <option value="nv">Naamloze Vennootschap (N.V.)</option>
                            <option value="cv">Commanditaire Vennootschap (C.V.)</option>
                            <option value="maatschap">Maatschap</option>
                            <option value="stichting">Stichting</option>
                            <option value="vereniging">Vereniging</option>
                            <option value="anders">Anders</option>
                        </select>
                    </div>

                    <!-- Start UBO Sectie in Stap 1 -->
                    <div id="uboSectieStap1" style="display: none; padding: 15px 0px; margin-top:10px; margin-bottom: 20px; border-top: 1px dashed var(--form-border-color); border-bottom: 1px dashed var(--form-border-color);">
                        <h3 style="font-size: 1.3rem; margin-bottom: 10px; color: var(--form-text-color); padding-bottom: 5px;">
                            UBO Gegevens / Statutair Bestuurders
                        </h3>
                        <p style="font-size: 0.85rem; color: var(--form-label-color); margin-bottom: 20px;">
                            Afhankelijk van de gekozen rechtsvorm is het opgeven van UBO's (Ultimate Beneficial Owners) verplicht.
                            Een UBO is een natuurlijk persoon die de uiteindelijke eigenaar is van of zeggenschap heeft over een onderneming.
                        </p>
                        <div id="ubo-forms-container">
                            <!-- Eerste UBO-sectie (initieel aanwezig) -->
                            <div class="ubo-section" data-ubo-index="1">
                                <h4>UBO 1 / Statutair Bestuurder 1</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="ubo1_voornamen">Volledige voornamen<span class="asterisk"></span></label>
                                        <input type="text" id="ubo1_voornamen" name="ubo1_voornamen">
                                    </div>
                                    <div class="form-group" style="flex: 0.5;">
                                        <label for="ubo1_tussenvoegsel">Tussenvoegsel(s)</label>
                                        <input type="text" id="ubo1_tussenvoegsel" name="ubo1_tussenvoegsel">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="ubo1_achternaam">Eigen achternaam<span class="asterisk"></span></label>
                                    <input type="text" id="ubo1_achternaam" name="ubo1_achternaam">
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="ubo1_geboortedatum">Geboortedatum<span class="asterisk"></span></label>
                                        <input type="date" id="ubo1_geboortedatum" name="ubo1_geboortedatum">
                                    </div>
                                    <div class="form-group">
                                        <label for="ubo1_woonland">Woonland<span class="asterisk"></span></label>
                                        <input type="text" id="ubo1_woonland" name="ubo1_woonland">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>Type UBO<span class="asterisk">*</span></label>
                                    <div class="radio-group">
                                        <div><input type="radio" id="ubo1_type_eigendom" name="ubo1_type" value="eigendom"><label for="ubo1_type_eigendom" class="radio-label">Op basis van eigendom</label></div>
                                        <div><input type="radio" id="ubo1_type_zeggenschap" name="ubo1_type" value="zeggenschap"><label for="ubo1_type_zeggenschap" class="radio-label">Op basis van zeggenschap</label></div>
                                        <div><input type="radio" id="ubo1_type_statutair" name="ubo1_type" value="statutair"><label for="ubo1_type_statutair" class="radio-label">Op basis van (statutair) bestuur</label></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="ubo1_adres">Volledige adres<span class="asterisk">*</span></label>
                                    <input type="text" id="ubo1_adres" name="ubo1_adres" placeholder="Straatnaam Huisnr, Postcode Plaats">
                                </div>
                                <!-- Eerste UBO sectie heeft geen eigen "Verwijder" knop als het de enige is -->
                            </div>
                            <!-- Dynamisch toegevoegde UBOs komen hier -->
                        </div>
                        <button type="button" onclick="UBOtoevoegen()" class="cta-button" style="margin-top: 15px; font-size: 1rem; padding: 10px 20px;">Extra UBO/Bestuurder Toevoegen</button>
                    </div>
                    <!-- Einde UBO Sectie in Stap 1 -->

                    <div class="form-group">
                        <label for="straatHuisnrZakelijk">Straat en huisnummer:</label>
                        <input type="text" id="straatHuisnrZakelijk" name="straatHuisnrZakelijk" placeholder="Voorbeeldstraat 123" required>
                        <br>

                        <label for="postcodeZakelijkApart">Postcode:</label>
                        <input type="text" id="postcodeZakelijkApart" name="postcodeZakelijkApart" placeholder="1234 AB"
                                pattern="^\d{4}\s?[a-zA-Z]{2}$"
                                title="Voer een geldige Nederlandse postcode in (bijv. 1234 AB)." required>
                        <br>

                        <label for="plaatsZakelijk">Plaats:</label>
                        <input type="text" id="plaatsZakelijk" name="plaatsZakelijk" placeholder="Amsterdam" required>
                        <br>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="telefoonnummerZakelijk">Telefoonnummer<span class="asterisk">*</span></label>
                            <input type="tel" id="telefoonnummerZakelijk" name="telefoonnummerZakelijk" maxlength="10" title="Vul een geldig telefoonnummer in (minimaal 7 cijfers)">
                        </div>
                        <div class="form-group">
                            <label for="emailadresZakelijk">E-mailadres<span class="asterisk">*</span></label>
                            <input type="email" id="emailadresZakelijk" name="emailadresZakelijk" pattern="[a-z0-9._%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$" title="Vul een geldig e-mailadres in">
                        </div>
                    </div>
                </div>

                <!-- Particuliere Velden Container -->
                <div id="particulierFieldsContainer" style="display: none;">
                    <div class="form-group">
                        <label for="naamVoorlettersParticulier">Naam en voorletter(s)<span class="asterisk">*</span></label>
                        <input type="text" id="naamVoorlettersParticulier" name="naamVoorlettersParticulier">
                    </div>
                    <div class="form-group">
                        <label>Geslacht<span class="asterisk">*</span></label>
                        <div class="radio-group">
                            <div><input type="radio" id="geslachtManParticulier" name="geslachtParticulier" value="man"><label for="geslachtManParticulier" class="radio-label">Man</label></div>
                            <div><input type="radio" id="geslachtVrouwParticulier" name="geslachtParticulier" value="vrouw"><label for="geslachtVrouwParticulier" class="radio-label">Vrouw</label></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="geboortedatumParticulier">Geboortedatum<span class="asterisk">*</span></label>
                        <input type="date" id="geboortedatumParticulier" name="geboortedatumParticulier">
                    </div>
                    <div class="form-group">
                        <label for="postadresParticulier">Woonadres<span class="asterisk">*</span></label>
                        <input type="text" id="postadresParticulier" name="postadresParticulier" placeholder="Straatnaam Huisnr, Postcode Plaats">
                    </div>
                     <div class="form-row">
                        <div class="form-group">
                            <label for="telefoonnummerParticulier">Telefoonnummer<span class="asterisk">*</span></label>
                            <input type="tel" id="telefoonnummerParticulier" name="telefoonnummerParticulier">
                        </div>
                        <div class="form-group">
                            <label for="emailadresParticulier">E-mailadres<span class="asterisk">*</span></label>
                            <input type="email" id="emailadresParticulier" name="emailadresParticulier">
                        </div>
                    </div>
                </div>
                
                <div class="form-navigation-buttons">
                    <button type="button" class="nav-button prev-button" style="visibility: hidden;">Vorige</button>
                    <button type="button" class="nav-button save-button" onclick="handleSaveButtonClick(this)">Voortgang Opslaan</button>
                    <button type="button" class="nav-button next-button" onclick="nextStep()">Volgende</button>
                </div>
            </fieldset>

            <!-- Stap 2: Werkdetails -->
            <fieldset class="form-step" data-step-name="Werk">
                 <legend>2. Werkdetails</legend>
                 <div class="form-group">
                    <label for="startWerkzaamheden">Wanneer beginnen de werkzaamheden of per welke datum zijn de werkzaamheden begonnen?<span class="asterisk">*</span></label>
                    <input type="date" id="startWerkzaamheden" name="startWerkzaamheden" required>
                </div>
                 <div class="form-group">
                    <label for="ingangsdatumVerzekering">Ingangsdatum verzekering<span class="asterisk">*</span></label>
                    <input type="date" id="ingangsdatumVerzekering" name="ingangsdatumVerzekering" required>
                </div>
                <div class="form-group" id="redenLateStartContainer" style="display: none;">
                    <label for="redenLateStart">Als de werkzaamheden al zijn begonnen voor de ingangsdatum, wat is de reden?</label>
                    <textarea id="redenLateStart" name="redenLateStart"></textarea>
                    <p class="help-text" style=" color: #777; font-size: 0.9em;
                    margin-top: 5px;">We nemen nog contact op voor aanvullende informatie.</p>
                </div>
                <div class="form-group">
                    <label for="duurBouwMaanden">Geschatte duur bouw (maanden)?<span class="asterisk">*</span></label>
                    <input type="number" id="duurBouwMaanden" name="duurBouwMaanden" min="1" required>
                    <p class="duurBouwWaarschuwing" style="display:none; color: #777; font-size: 0.9em; margin-top: 5px;">
                        Voor projecten langer dan 12 maanden nemen we mogelijk contact op voor aanvullende informatie.
                    </p>
                </div>
                <div class="form-group">
                    <label>Soort werkzaamheden (meerdere keuzes mogelijk):<span class="asterisk">*</span>
                        <span class="help-tip">
                            <p>Selecteer alle soorten werkzaamheden die van toepassing zijn op uw project. Dit helpt ons de risico's correct in te schatten.</p>
                        </span>
                    </label>
                    <div class="checkbox-group">
                        <div><input type="checkbox" id="werk_nieuwbouw_woning_ja" name="werkSoort[]" value="nieuwbouw_woning"><label for="werk_nieuwbouw_woning_ja" class="checkbox-label">Nieuwbouw woning</label></div>
                        <div><input type="checkbox" id="werk_verbouw_woning_nee" name="werkSoort[]" value="verbouw_woning"><label for="werk_verbouw_woning_nee" class="checkbox-label">Verbouw woning</label></div>
                        <div><input type="checkbox" id="werk_nieuwbouw_bedrijf_nee" name="werkSoort[]" value="nieuwbouw_bedrijf"><label for="werk_nieuwbouw_bedrijf_nee" class="checkbox-label">Nieuwbouw bedrijfspand</label></div>
                        <div><input type="checkbox" id="werk_verbouw_bedrijf_ja" name="werkSoort[]" value="verbouw_bedrijf"><label for="werk_verbouw_bedrijf_ja" class="checkbox-label">Verbouw bedrijfspand</label></div>
                        <div><input type="checkbox" id="werk_installatie_nee" name="werkSoort[]" value="installatiewerk"><label for="werk_installatie_nee" class="checkbox-label">Installatiewerkzaamheden</label></div>
                        <div><input type="checkbox" id="werk_gww_nee" name="werkSoort[]" value="gww"><label for="werk_gww_nee" class="checkbox-label">Grond-, Weg- en Waterbouw (GWW)</label></div>
                        <div>
                            <input type="checkbox" id="werk_anders_ja" name="werkSoort[]" value="anders" onclick="toggleConditional('werkAndersSpecificatieContainer', this.checked)">
                            <label for="werk_anders_ja" class="checkbox-label">Anders, namelijk:</label>
                        </div>
                    </div>
                </div>
                <div id="werkAndersSpecificatieContainer" class="conditional-section">
                    <div class="form-group">
                        <label for="werk_anders_specificatie">Specificatie andere werkzaamheden<span class="asterisk">*</span></label>
                        <textarea id="werk_anders_specificatie" name="werk_anders_specificatie" placeholder="Beschrijf hier de andere werkzaamheden"></textarea>
                    </div>
                </div>

                <div class="form-group">
                    <label>Onderhoudstermijn overeengekomen?<span class="asterisk">*</span>
                        <span class="help-tip">
                            <p>Is er een periode na oplevering afgesproken waarin u verantwoordelijk bent voor herstel van gebreken?</p>
                        </span>
                    </label>
                    <div class="radio-group">
                        <div><input type="radio" id="onderhoudstermijnOvereen_ja" name="onderhoudstermijnOvereen" value="ja" required onclick="toggleConditional('onderhoudstermijnOvereenDetails', true)"><label for="onderhoudstermijnOvereen_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="onderhoudstermijnOvereen_nee" name="onderhoudstermijnOvereen" value="nee" onclick="toggleConditional('onderhoudstermijnOvereenDetails', false)"><label for="onderhoudstermijnOvereen_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="onderhoudstermijnOvereenDetails" class="conditional-section">
                    <div class="form-group">
                        <label>Onderhoudstermijn meeverzekeren?<span class="asterisk">*</span>
                            <span class="help-tip">
                                <p>Wilt u eventuele schade tijdens deze onderhoudsperiode meeverzekeren?</p>
                            </span>
                        </label>
                         <div class="radio-group">
                            <div><input type="radio" id="onderhoudstermijnMeeVerzekeren_ja" name="onderhoudstermijnMeeVerzekeren" value="ja" onclick="toggleConditional('onderhoudstermijnDuurDetails', true)"><label for="onderhoudstermijnMeeVerzekeren_ja" class="radio-label">Ja</label></div>
                            <div><input type="radio" id="onderhoudstermijnMeeVerzekeren_nee" name="onderhoudstermijnMeeVerzekeren" value="nee" onclick="toggleConditional('onderhoudstermijnDuurDetails', false)"><label for="onderhoudstermijnMeeVerzekeren_nee" class="radio-label">Nee</label></div>
                        </div>
                    </div>
                    <div id="onderhoudstermijnDuurDetails" class="conditional-section">
                         <div class="form-group">
                            <label>Duur onderhoudstermijn?<span class="asterisk">*</span></label>
                            <div class="radio-group">
                                <div><input type="radio" id="duurOnderhoud_3" name="duurOnderhoud" value="3"><label for="duurOnderhoud_3" class="radio-label">3 maanden</label></div>
                                <div><input type="radio" id="duurOnderhoud_6" name="duurOnderhoud" value="6"><label for="duurOnderhoud_6" class="radio-label">6 maanden</label></div>
                                <div><input type="radio" id="duurOnderhoud_12" name="duurOnderhoud" value="12"><label for="duurOnderhoud_12" class="radio-label">12 maanden</label></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="aanneemsom">Aanneemsom van het werk?<span class="asterisk">*</span>
                        <span class="help-tip">
                            <p>De totale waarde van het project, inclusief materialen en arbeid. Geef aan of dit inclusief of exclusief BTW is.</p>
                        </span>
                    </label>
                    <div class="input-group">
                        <span class="currency-symbol">€</span>
                        <input type="number" id="aanneemsom" name="aanneemsom" step="0.01" required>
                    </div>
                </div>
                <div class="form-group" id="btwField">
                    <label>BTW<span class="asterisk">*</span></label>
                    <div class="radio-group">
                        <div>
                            <input type="radio" id="btw_inclusief" name="btw" value="inclusief" required>
                            <label for="btw_inclusief" class="radio-label">Inclusief btw</label>
                        </div>
                        <div>
                            <input type="radio" id="btw_exclusief" name="btw" value="exclusief">
                            <label for="btw_exclusief" class="radio-label">Exclusief btw</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Aanneemsom inclusief:
                        <span class="help-tip">
                            <p>Selecteer welke posten zijn inbegrepen in de opgegeven aanneemsom.</p>
                        </span>
                    </label>
                    <div class="checkbox-group">
                        <div><input type="checkbox" id="inc_honoraria" name="aanneemsomInclusief[]" value="honoraria"><label for="inc_honoraria" class="checkbox-label">Honoraria</label></div>
                        <div><input type="checkbox" id="inc_toezicht" name="aanneemsomInclusief[]" value="toezicht"><label for="inc_toezicht" class="checkbox-label">Toezicht/controle</label></div>
                        <div><input type="checkbox" id="inc_buitenbestek" name="aanneemsomInclusief[]" value="buitenbestek"><label for="inc_buitenbestek" class="checkbox-label">Buiten bestek</label></div>
                        <div><input type="checkbox" id="inc_opdrachtgeverWerk" name="aanneemsomInclusief[]" value="opdrachtgeverWerk"><label for="inc_opdrachtgeverWerk" class="checkbox-label">Werk opdrachtgever</label></div>
                        <div><input type="checkbox" id="inc_opdrachtgeverBouwcomp" name="aanneemsomInclusief[]" value="opdrachtgeverBouwcomp"><label for="inc_opdrachtgeverBouwcomp" class="checkbox-label">Componenten opdrachtgever</label></div>
                        <div><input type="checkbox" id="inc_geen" name="aanneemsomInclusief[]" value="geen"><label for="inc_geen" class="checkbox-label">Geen van deze</label></div>
                    </div>
                </div>

                <div class="form-navigation-buttons">
                    <button type="button" class="nav-button prev-button" onclick="prevStep()">Vorige</button>
                    <button type="button" class="nav-button save-button" onclick="handleSaveButtonClick(this)">Voortgang Opslaan</button>
                    <button type="button" class="nav-button next-button" onclick="nextStep()">Volgende</button>
                </div>
            </fieldset>

            <!-- Stap 3: Verzekerde Sommen & Risico's -->
            <fieldset class="form-step" data-step-name="Sommen">
                 <legend>3. Verzekerde Sommen & Risico's</legend>
                 <div class="form-group">
                    <label>Aansprakelijkheid (secundaire dekking)<span class="asterisk">*</span>
                        <span class="help-tip">
                            <p>Dit dekt schade aan anderen waarvoor u aansprakelijk bent, als aanvulling op uw bestaande AVB. Kies het gewenste dekkingsbedrag of 'Niet meeverzekeren'.</p>
                        </span>
                    </label>
                    <select name="aansprakelijkheid_som" required>
                        <option value="" disabled selected>Kies een bedrag</option>
                        <option value="500000">tot € 500.000,-</option>
                        <option value="1250000">tot € 1.250.000,-</option>
                        <option value="2500000">tot € 2.500.000,-</option>
                        <option value="niet_meeverzekeren">Niet meeverzekeren</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Bestaande eigendommen opdrachtgever<span class="asterisk">*</span></label>
                    <select name="bestaande_eigendommen_som" id="bestaande_eigendommen_som" onchange="toonAndersVeld(this, 'anders_bestaand_eigendommen_input', 'anders_bestaand_eigendommen_message')" required>
                        <option value="" disabled selected>Kies een bedrag</option>
                        <option value="50000">tot € 50.000,-</option>
                        <option value="125000">tot € 125.000,-</option>
                        <option value="250000">tot € 250.000,-</option>
                        <option value="niet_meeverzekeren">Niet meeverzekeren</option>
                        <option value="Anders">Anders</option>
                    </select>
                    <div class="input-group" id="anders_bestaand_eigendommen_input" style="display: none; margin-top: 8px;">
                        <span class="currency-symbol">€</span>
                        <input type="number" name="bestaande_eigendommen_som_anders_val" placeholder="Anders, namelijk...">
                    </div>
                    <p class="anders-waarschuwing" id="anders_bestaand_eigendommen_message">We nemen nog contact op voor aanvullende informatie.</p>
                </div>
                <div class="form-group">
                    <label>Hulpmateriaal<span class="asterisk">*</span></label>
                    <select name="Hulpmateriaal" id="Hulpmateriaal" onchange="toonAndersVeld(this, 'anders_Hulpmateriaal_input', 'anders_Hulpmateriaal_message')" required>
                        <option value="" disabled selected>Kies een bedrag</option>
                        <option value="50000">tot € 50.000,-</option>
                        <option value="125000">tot € 125.000,-</option>
                        <option value="250000">tot € 250.000,-</option>
                        <option value="niet_meeverzekeren">Niet meeverzekeren</option>
                        <option value="Anders">Anders</option>
                    </select>
                    <div class="input-group" id="anders_Hulpmateriaal_input" style="display: none; margin-top: 8px;">
                        <span class="currency-symbol">€</span>
                        <input type="number" name="anders_Hulpmateriaal_val" placeholder="Anders, namelijk...">
                    </div>
                    <p class="anders-waarschuwing" id="anders_Hulpmateriaal_message">We nemen nog contact op voor aanvullende informatie.</p>
                </div>
                <div class="form-group">
                    <label>Eigen risico<span class="asterisk">*</span></label>
                    <select name="Eigen_risico_select" id="Eigen_risico" onchange="toonAndersVeld(this, 'anders_Eigen_risico_input', 'anders_Eigen_risico_message')" required> <!-- Changed name to avoid conflict -->
                        <option value="" disabled selected>Kies een bedrag</option>
                        <option value="500">tot € 500,-</option>
                        <option value="1000">tot € 1.000,-</option>
                        <option value="2500">tot € 2.500,-</option>
                        <option value="5000">tot € 5.000,-</option>
                        <option value="niet_meeverzekeren">Niet meeverzekeren</option>
                        <option value="Anders">Anders</option>
                    </select>
                    <div class="input-group" id="anders_Eigen_risico_input" style="display: none; margin-top: 8px;">
                        <span class="currency-symbol">€</span>
                        <input type="number" name="anders_Eigen_risico_val" placeholder="Anders, namelijk...">
                    </div>
                    <p class="anders-waarschuwing" id="anders_Eigen_risico_message">We nemen nog contact op voor aanvullende informatie.</p>
                </div>
                <div class="form-group">
                    <label>Wil je bedrijfsschade meeverzekeren?<span class="asterisk">*</span></label>
                     <div class="radio-group">
                        <div><input type="radio" id="bedrijfsschade_ja" name="bedrijfsschade_meeverzekeren" value="ja" onclick="toggleConditional('bedrijfsschadeDetails', true)"><label for="bedrijfsschade_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="bedrijfsschade_nee" name="bedrijfsschade_meeverzekeren" value="nee" checked onclick="toggleConditional('bedrijfsschadeDetails', false)"><label for="bedrijfsschade_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="bedrijfsschadeDetails" class="conditional-section">
                    <div class="form-group">
                        <label for="bedrijfsschade_belang">Verzekerd belang bedrijfsschade<span class="asterisk">*</span></label>
                        <div class="input-group">
                            <span class="currency-symbol">€</span>
                            <input type="number" id="bedrijfsschade_belang" name="bedrijfsschade_belang">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="bedrijfsschade_uitkeringstermijn">Uitkeringstermijn (weken)<span class="asterisk">*</span></label>
                        <input type="number" id="bedrijfsschade_uitkeringstermijn" name="bedrijfsschade_uitkeringstermijn">
                    </div>
                </div>

                <div class="form-navigation-buttons">
                    <button type="button" class="nav-button prev-button" onclick="prevStep()">Vorige</button>
                    <button type="button" class="nav-button save-button" onclick="handleSaveButtonClick(this)">Voortgang Opslaan</button>
                    <button type="button" class="nav-button next-button" onclick="nextStep()">Volgende</button>
                </div>
            </fieldset>

            <!-- Stap 4: Constructiedetails -->
            <fieldset class="form-step" data-step-name="Constructie">
                 <legend>4. Constructiedetails & Specifieke Risico's</legend>
                <!-- ... (inhoud van stap 4 blijft hetzelfde) ... -->
                <div class="form-group">
                    <label for="locatieWerk">Waar wordt het werk gerealiseerd?<span class="asterisk">*</span></label>
                    <input type="text" id="locatieWerk" name="locatieWerk" required>
                </div>
                <div class="form-group">
                    <label>Aard van gebouw/bouwwerk<span class="asterisk">*</span></label>
                    <div class="radio-group">
                        <div><input type="radio" id="aardGebouw_steen" name="aardGebouw" value="steenhard" required onclick="hideLinkedText('aardGebouwAndersText')"><label for="aardGebouw_steen" class="radio-label">Steen/hard</label></div>
                        <div><input type="radio" id="aardGebouw_metaal" name="aardGebouw" value="metaalhard" onclick="hideLinkedText('aardGebouwAndersText')"><label for="aardGebouw_metaal" class="radio-label">Metaal/hard</label></div>
                        <div> <!-- Container for radio, label, and inline text -->
                            <input type="radio" id="aardGebouw_andersRadio" name="aardGebouw" value="anders" onclick="showLinkedText('aardGebouwAndersText')">
                            <label for="aardGebouw_andersRadio" class="radio-label">Anders, namelijk:</label>
                            <input type="text" id="aardGebouwAndersText" name="aardGebouwAndersText" class="inline-text-input">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Worden er sloopwerkzaamheden verricht aan dragende constructies?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="sloopwerk_ja" name="sloopwerk" value="ja" onclick="toggleConditional('sloopwerkDetails', true)"><label for="sloopwerk_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="sloopwerk_nee" name="sloopwerk" value="nee" checked onclick="toggleConditional('sloopwerkDetails', false)"><label for="sloopwerk_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="sloopwerkDetails" class="conditional-section">
                    <div class="form-group">
                        <label for="sloopwerk_constructies">Welke dragende constructies worden gesloopt?</label>
                        <textarea id="sloopwerk_constructies" name="sloopwerk_constructies" placeholder="Bijv. muren, kolommen, vloeren..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Is hiervoor door een gekwalificeerd constructeur een schriftelijk sloopadvies opgesteld dat gericht is op het voorkomen van schade aan te behouden zaken?</label>
                         <div class="radio-group">
                            <div><input type="radio" id="sloopadvies_ja" name="sloopadvies" value="ja"><label for="sloopadvies_ja" class="radio-label">Ja</label></div>
                            <div><input type="radio" id="sloopadvies_nee" name="sloopadvies" value="nee"><label for="sloopadvies_nee" class="radio-label">Nee</label></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Vindt er bemaling plaats?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="bemaling_ja" name="bemaling" value="ja" onclick="toggleConditional('bemalingDetails', true)"><label for="bemaling_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="bemaling_nee" name="bemaling" value="nee" checked onclick="toggleConditional('bemalingDetails', false)"><label for="bemaling_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="bemalingDetails" class="conditional-section">
                    <div class="form-group">
                        <label>Is hiervoor door een geotechnisch adviseur een schriftelijk bemalingsadvies opgesteld waaruit blijkt dat de omgeving de benodigde grondwaterstandverlaging kan doorstaan met een verwaarloosbare kans op schade?</label>
                         <div class="radio-group">
                            <div><input type="radio" id="bemalingsadvies_ja" name="bemalingsadvies" value="ja"><label for="bemalingsadvies_ja" class="radio-label">Ja</label></div>
                            <div><input type="radio" id="bemalingsadvies_nee" name="bemalingsadvies" value="nee"><label for="bemalingsadvies_nee" class="radio-label">Nee</label></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Wordt er binnen vijf meter langs een bestaande fundering gegraven tot dieper dan die bestaande fundering?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="gravenNabijFundering_ja" name="gravenNabijFundering" value="ja" onclick="toggleConditional('gravenNabijFunderingDetails', true)"><label for="gravenNabijFundering_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="gravenNabijFundering_nee" name="gravenNabijFundering" value="nee" checked onclick="toggleConditional('gravenNabijFunderingDetails', false)"><label for="gravenNabijFundering_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="gravenNabijFunderingDetails" class="conditional-section">
                    <div class="form-group">
                        <label>Is hiervoor door een geotechnisch adviseur een schriftelijk uitvoeringsplan opgesteld waaruit blijkt dat deze fundering de ontgraving kan verdragen met een verwaarloosbare kans op schade?</label>
                         <div class="radio-group">
                            <div><input type="radio" id="uitvoeringsplanGraven_ja" name="uitvoeringsplanGraven" value="ja"><label for="uitvoeringsplanGraven_ja" class="radio-label">Ja</label></div>
                            <div><input type="radio" id="uitvoeringsplanGraven_nee" name="uitvoeringsplanGraven" value="nee"><label for="uitvoeringsplanGraven_nee" class="radio-label">Nee</label></div>
                        </div>
                    </div>
                </div>
                 <div class="form-group">
                    <label>Is er sprake van de bouw van een kelder of zwembad?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="kelderZwembad_ja" name="kelderZwembad" value="ja"><label for="kelderZwembad_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="kelderZwembad_nee" name="kelderZwembad" value="nee" checked><label for="kelderZwembad_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Wordt er een paalfundering aangebracht?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="paalfundering_ja" name="paalfundering" value="ja" onclick="toggleConditional('paalfunderingDetails', true)"><label for="paalfundering_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="paalfundering_nee" name="paalfundering" value="nee" checked onclick="toggleConditional('paalfunderingDetails', false)"><label for="paalfundering_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="paalfunderingDetails" class="conditional-section">
                    <div class="form-group">
                        <label>Is hiervoor door een geotechnisch adviseur een schriftelijk funderingsadvies opgesteld waaruit blijkt dat de omgeving deze werkzaamheden kan doorstaan met een verwaarloosbare kans op schade?</label>
                        <div class="radio-group">
                            <div><input type="radio" id="funderingsadviesPaal_ja" name="funderingsadviesPaal" value="ja"><label for="funderingsadviesPaal_ja" class="radio-label">Ja</label></div>
                            <div><input type="radio" id="funderingsadviesPaal_nee" name="funderingsadviesPaal" value="nee"><label for="funderingsadviesPaal_nee" class="radio-label">Nee</label></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Welk paalsysteem wordt er toegepast?</label>
                        <div class="radio-group">
                            <div><input type="radio" id="paalsysteem_geslagen" name="paalsysteem" value="geslagen_getrild"><label for="paalsysteem_geslagen" class="radio-label">Geslagen/getrild</label></div>
                            <div><input type="radio" id="paalsysteem_gedrukt" name="paalsysteem" value="gedrukt"><label for="paalsysteem_gedrukt" class="radio-label">Gedrukt</label></div>
                            <div><input type="radio" id="paalsysteem_geboord" name="paalsysteem" value="geboord"><label for="paalsysteem_geboord" class="radio-label">Geboord</label></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Staan er bouwwerken binnen een afstand van 15 meter van de aan te brengen paalfundering?</label>
                        <div class="radio-group">
                            <div><input type="radio" id="bouwwerkenBinnen15m_ja" name="bouwwerkenBinnen15m" value="ja" onclick="toggleConditional('bouwwerkenBinnen15mDetails', true)"><label for="bouwwerkenBinnen15m_ja" class="radio-label">Ja</label></div>
                            <div><input type="radio" id="bouwwerkenBinnen15m_nee" name="bouwwerkenBinnen15m" value="nee" onclick="toggleConditional('bouwwerkenBinnen15mDetails', false)"><label for="bouwwerkenBinnen15m_nee" class="radio-label">Nee</label></div>
                        </div>
                    </div>
                    <div id="bouwwerkenBinnen15mDetails" class="conditional-section">
                        <div class="form-group">
                            <label>Van wie zijn de bouwwerken?</label>
                            <div class="radio-group">
                                <div><input type="radio" id="eigenaarBouwwerk_opdrachtgever" name="eigenaarBouwwerk" value="opdrachtgever"><label for="eigenaarBouwwerk_opdrachtgever" class="radio-label">Van opdrachtgever</label></div>
                                <div><input type="radio" id="eigenaarBouwwerk_anderen" name="eigenaarBouwwerk" value="anderen"><label for="eigenaarBouwwerk_anderen" class="radio-label">Van anderen</label></div>
                                <div><input type="radio" id="eigenaarBouwwerk_beide" name="eigenaarBouwwerk" value="beide"><label for="eigenaarBouwwerk_beide" class="radio-label">Beide</label></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="afstandDichtstbijzijndeBouwwerk">Op hoeveel meter afstand staat het dichtstbijzijnde bouwwerk?</label>
                            <div class="input-group">
                                <input type="number" id="afstandDichtstbijzijndeBouwwerk" name="afstandDichtstbijzijndeBouwwerk" min="0" step="0.1">
                                <span class="unit-symbol">meter</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Zijn de bouwwerken binnen een afstand van 15 meter ook op palen gefundeerd?</label>
                            <div class="radio-group">
                                <div><input type="radio" id="ookOpPalen_ja" name="ookOpPalen" value="ja" onclick="toggleConditional('andereFunderingswijzeDetails', false); hideLinkedText('andereFunderingswijze');"><label for="ookOpPalen_ja" class="radio-label">Ja</label></div>
                                <div> <!-- Modified this radio's onclick to also control the text field directly -->
                                    <input type="radio" id="ookOpPalen_nee" name="ookOpPalen" value="nee" onclick="toggleConditional('andereFunderingswijzeDetails', true); showLinkedText('andereFunderingswijze');">
                                    <label for="ookOpPalen_nee" class="radio-label">Nee</label>
                                </div>
                            </div>
                        </div>
                        <div id="andereFunderingswijzeDetails" class="conditional-section">
                             <div class="form-group"> <!-- This form-group wraps the text input for "andere funderingswijze" -->
                                <label for="andereFunderingswijze">Zo nee, welke funderingswijze is er dan toegepast?</label>
                                <input type="text" id="andereFunderingswijze" name="andereFunderingswijze" placeholder="Bijv. op staal, strokenfundering..." class="inline-text-input"> <!-- Applied class here too -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Worden er grondkerende constructies (zoals een damwand of berlinerwand) aangebracht?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="grondkering_ja" name="grondkering" value="ja" onclick="toggleConditional('grondkeringDetails', true)"><label for="grondkering_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="grondkering_nee" name="grondkering" value="nee" checked onclick="toggleConditional('grondkeringDetails', false)"><label for="grondkering_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="grondkeringDetails" class="conditional-section">
                     <div class="form-group">
                        <label>Is hiervoor door een geotechnisch adviseur een schriftelijk advies opgesteld waaruit blijkt dat de omgeving deze werkzaamheden kan doorstaan met een verwaarloosbare kans op schade?</label>
                         <div class="radio-group">
                            <div><input type="radio" id="adviesGrondkering_ja" name="adviesGrondkering" value="ja"><label for="adviesGrondkering_ja" class="radio-label">Ja</label></div>
                            <div><input type="radio" id="adviesGrondkering_nee" name="adviesGrondkering" value="nee"><label for="adviesGrondkering_nee" class="radio-label">Nee</label></div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Is er sprake van funderingsherstel of verbetering van de fundering?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="funderingsherstel_ja" name="funderingsherstel" value="ja"><label for="funderingsherstel_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="funderingsherstel_nee" name="funderingsherstel" value="nee" checked><label for="funderingsherstel_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>

                <div class="form-navigation-buttons">
                    <button type="button" class="nav-button prev-button" onclick="prevStep()">Vorige</button>
                    <button type="button" class="nav-button save-button" onclick="handleSaveButtonClick(this)">Voortgang Opslaan</button>
                    <button type="button" class="nav-button next-button" onclick="nextStep()">Volgende</button>
                </div>
            </fieldset>

            <!-- Stap 5: Uitvoering & Aannemer -->
             <fieldset class="form-step" data-step-name="Uitvoering">
                 <legend>5. Uitvoering & Aannemer</legend>
                <!-- ... (inhoud van stap 5 blijft hetzelfde) ... -->
                 <div class="form-group">
                    <label>Dient er een bedrag voor arbeidsloon meeverzekerd te worden?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="arbeidsloon_ja" name="arbeidsloon_meeverzekeren" value="ja" onclick="toggleConditional('arbeidsloonDetails', true)"><label for="arbeidsloon_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="arbeidsloon_nee" name="arbeidsloon_meeverzekeren" value="nee" checked onclick="toggleConditional('arbeidsloonDetails', false)"><label for="arbeidsloon_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="arbeidsloonDetails" class="conditional-section">
                    <div class="form-group">
                        <label for="arbeidsloon_som">Verzekerde som arbeidsloon</label>
                        <div class="input-group">
                            <span class="currency-symbol">€</span>
                            <input type="number" id="arbeidsloon_som" name="arbeidsloon_som">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Wordt het werk door een aannemer uitgevoerd?</label>
                    <div class="radio-group">
                        <div><input type="radio" id="werkDoorAannemer_nee" name="werkDoorAannemer" value="nee" onclick="toggleConditional('aannemerDetailopmerking', true);toggleConditional('aannemerDetailsContainer', false)"><label for="werkDoorAannemer_nee" class="radio-label">Nee</label></div>
                        <div><input type="radio" id="werkDoorAannemer_geheel" name="werkDoorAannemer" value="geheel" checked onclick="toggleConditional('aannemerDetailsContainer', true);toggleConditional('aannemerDetailopmerking', false)"><label for="werkDoorAannemer_geheel" class="radio-label">Geheel</label></div>
                        <div><input type="radio" id="werkDoorAannemer_gedeeltelijk" name="werkDoorAannemer" value="gedeeltelijk" onclick="toggleConditional('aannemerDetailsContainer', true);toggleConditional('aannemerDetailopmerking', false)"><label for="werkDoorAannemer_gedeeltelijk" class="radio-label">Gedeeltelijk</label></div>
                    </div>
                </div>

                <div id="aannemerDetailopmerking" class="conditional-section">
                    <div class="form-group">
                        <label for="aannemer_opmerking">Opmerking</label>
                        <textarea id="aannemer_opmerking" name="aannemer_opmerking" placeholder="Bijv. Waarom wordt het werk door de aannemer niet uitgevoerd?"></textarea>
                    </div>
                </div>
                <div id="aannemerDetailsContainer" class="conditional-section">
                    <div id="aannemer-forms-container">
                        <!-- Eerste aannemer-sectie (initieel aanwezig) -->
                        <div class="aannemer-section" data-aannemer-index="1">
                            <h4>Aannemer 1</h4>
                            <div class="form-group">
                                <label for="aannemer1_naam">Naam van de aannemer<span class="asterisk">*</span></label>
                                <input type="text" id="aannemer1_naam" name="aannemer1_naam">
                            </div>
                            <div class="form-group">
                                <label for="aannemer1_adres">Adresgegevens aannemer<span class="asterisk">*</span></label>
                                <input type="text" id="aannemer1_adres" name="aannemer1_adres" placeholder="Straat Huisnr, Postcode Plaats">
                            </div>
                            <div class="form-group">
                                <label for="aannemer1_telefoon">Telefoonnummer aannemer</label>
                                <input type="tel" id="aannemer1_telefoon" name="aannemer1_telefoon">
                            </div>
                            <div class="form-group">
                                <label>Heeft deze aannemer een Bedrijfsaansprakelijkheidsverzekering (AVB)?<span class="asterisk">*</span></label>
                                <div class="radio-group">
                                    <div><input type="radio" id="aannemer1_avb_ja" name="aannemer1_avb" value="ja" onclick="toggleConditional('aannemer1_avbDetails', true)"><label for="aannemer1_avb_ja" class="radio-label">Ja</label></div>
                                    <div><input type="radio" id="aannemer1_avb_nee" name="aannemer1_avb" value="nee" onclick="toggleConditional('aannemer1_avbDetails', false)"><label for="aannemer1_avb_nee" class="radio-label">Nee</label></div>
                                </div>
                            </div>
                            <div id="aannemer1_avbDetails" class="conditional-section">
                                <div class="form-group">
                                    <label for="aannemer1_avb_maatschappij">Bij welke maatschappij?</label>
                                    <input type="text" id="aannemer1_avb_maatschappij" name="aannemer1_avb_maatschappij">
                                </div>
                                <div class="form-group">
                                    <label for="aannemer1_avb_polisnr">Polisnummer</label>
                                    <input type="text" id="aannemer1_avb_polisnr" name="aannemer1_avb_polisnr">
                                </div>
                                 <div class="form-row">
                                    <div class="form-group">
                                        <label for="aannemer1_avb_bedrag">Verzekerd bedrag</label>
                                        <div class="input-group"><span class="currency-symbol">€</span><input type="number" id="aannemer1_avb_bedrag" name="aannemer1_avb_bedrag" step="any"></div>
                                    </div>
                                    <div class="form-group">
                                        <label for="aannemer1_avb_eigenrisico">Eigen risico p.g.</label>
                                        <div class="input-group"><span class="currency-symbol">€</span><input type="number" id="aannemer1_avb_eigenrisico" name="aannemer1_avb_eigenrisico" step="any"></div>
                                    </div>
                                </div>
                            </div>
                             <!-- Verwijderknop wordt hier niet standaard getoond, alleen voor extra aannemers -->
                        </div>
                        <!-- Dynamisch toegevoegde aannemers komen hier -->
                    </div>
                    <button type="button" onclick="AannemerToevoegen()" class="cta-button" style="margin-top: 5px;">Extra Aannemer Toevoegen</button>
                </div>
                 <div class="form-group">
                    <label for="overige_opmerkingen_beoordeling">Overige opmerkingen voor beoordeling</label>
                    <textarea id="overige_opmerkingen_beoordeling" name="overige_opmerkingen_beoordeling"></textarea>
                </div>

                <div class="form-navigation-buttons">
                    <button type="button" class="nav-button prev-button" onclick="prevStep()">Vorige</button>
                    <button type="button" class="nav-button save-button" onclick="handleSaveButtonClick(this)">Voortgang Opslaan</button>
                    <button type="button" class="nav-button next-button" onclick="nextStep()">Volgende</button>
                </div>
            </fieldset>

            <!-- Stap 6: Afronding & Verklaringen -->
            <fieldset class="form-step" data-step-name="Afronding"> <!-- AANGEPAST -->
                 <legend>6. Afronding & Verklaringen</legend> <!-- AANGEPAST -->
                
                 <div class="form-group">
                    <label>Is deze verzekering momenteel elders ondergebracht?</label>
                     <div class="radio-group">
                        <div><input type="radio" id="elders_ondergebracht_ja" name="elders_ondergebracht" value="ja" onclick="toggleConditional('eldersOndergebrachtDetails', true)"><label for="elders_ondergebracht_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="elders_ondergebracht_nee" name="elders_ondergebracht" value="nee" checked onclick="toggleConditional('eldersOndergebrachtDetails', false)"><label for="elders_ondergebracht_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="eldersOndergebrachtDetails" class="conditional-section">
                    <div class="form-group">
                        <label for="vorige_maatschappij">Maatschappij</label>
                        <input type="text" id="vorige_maatschappij" name="vorige_maatschappij">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="vorige_polisnummer">Polisnummer</label>
                            <input type="text" id="vorige_polisnummer" name="vorige_polisnummer">
                        </div>
                        <div class="form-group">
                            <label for="vorige_afloopdatum">Afloopdatum</label>
                            <input type="date" id="vorige_afloopdatum" name="vorige_afloopdatum">
                        </div>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 25px;">
                    <label class="checkbox-label">
                        <input type="checkbox" name="verklaring_waarheid" required>
                        Ik verklaar alle gegevens naar waarheid te hebben ingevuld.<span class="asterisk">*</span>
                    </label>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="verklaring_contact_andere_verzekeringen">
                        Neem me contact met me op voor andere verzekeringen
                    </label>
                </div>

                <div class="form-navigation-buttons">
                    <button type="button" class="nav-button prev-button" onclick="prevStep()">Vorige</button>
                    <button type="button" class="nav-button save-button" onclick="handleSaveButtonClick(this)">Voortgang Opslaan</button>
                    <button type="submit" class="nav-button submit-button">Offerte Aanvragen</button>
                </div>
            </fieldset>
        </form>

        <!-- Contactinformatie sectie -->
        <div class="form-contact-footer">
            <h2>Heeft u vragen?</h2>
            <p>Indien u vragen heeft over dit formulier of uw aanvraag, neem dan gerust contact met ons op:</p>
            <div class="contact-details">
                <p class="contact-item">
                    E-mail: <a href="mailto:info@uwbedrijfsnaam.nl">info@uwbedrijfsnaam.nl</a>
                </p>
                <p class="contact-item">
                    Telefoon: <a href="tel:+31123456789">012 - 345 67 89</a>
                </p>
            </div>
        </div>
    </div>

        <script>

            // ... (Jouw bestaande JavaScript code voor het formulier, progress bar, etc.) ...

    // Mobile Menu Toggle voor form.html
    const menuToggleForm = document.querySelector('#mainHeader .menu-toggle'); // Wees specifiek
    const mainNavForm = document.querySelector('header#mainHeader nav#mainNavMenuForm'); // Wees specifiek

    if (menuToggleForm && mainNavForm) {
        menuToggleForm.addEventListener('click', () => {
            const isOpen = mainNavForm.classList.toggle('menu-open');
            menuToggleForm.classList.toggle('active'); // Voor de X animatie
            menuToggleForm.setAttribute('aria-expanded', isOpen);
            
            // Voorkom scrollen van de body als menu open is
            if (isOpen) {
                document.body.classList.add('menu-is-open');
            } else {
                document.body.classList.remove('menu-is-open');
            }
        });

        // Sluit menu als op een link wordt geklikt (voor single page navigatie)
        const navLinksMobileForm = mainNavForm.querySelectorAll('a');
        navLinksMobileForm.forEach(link => {
            link.addEventListener('click', () => {
                // Controleer of het een link is naar dezelfde pagina (hash-link)
                // of naar een andere pagina. Voor deze pagina zijn het altijd links naar een andere pagina.
                // We willen het menu sluiten, ongeacht waar de link naartoe gaat.
                if (mainNavForm.classList.contains('menu-open')) {
                    mainNavForm.classList.remove('menu-open');
                    menuToggleForm.classList.remove('active');
                    menuToggleForm.setAttribute('aria-expanded', 'false');
                    document.body.classList.remove('menu-is-open');
                }
            });
        });
    }

        
        // Zorg ervoor dat deze functie wordt aangeroepen bij het wisselen van type aanvrager
        document.querySelectorAll('input[name="aanvragerType"]').forEach(radio => {
            radio.addEventListener('change', function () {
                toggleBtwField(this.value);
            });
        });

        // Initialiseer de zichtbaarheid bij het laden van de pagina
        document.addEventListener('DOMContentLoaded', function () {
            const selectedType = document.querySelector('input[name="aanvragerType"]:checked');
            if (selectedType) {
                toggleBtwField(selectedType.value);
            } else {
                const btwField = document.getElementById('btwField');
                if(btwField) btwField.style.display = 'block'; // Default to show if no selection made initially
            }
        });

        function toggleBtwField(aanvragerType) {
            const btwField = document.getElementById('btwField');
            if (btwField) {
                if (aanvragerType === 'zakelijk') {
                    btwField.style.display = 'block';
                } else if (aanvragerType === 'particulier') {
                    btwField.style.display = 'none';
                    // Optioneel: reset BTW selectie
                    document.querySelectorAll('input[name="btw"]').forEach(rb => rb.checked = false);
                } else {
                    btwField.style.display = 'block'; // Default to show
                }
            }
        }


    document.getElementById('duurBouwMaanden').addEventListener('input', function () {
            const waarschuwing = document.querySelector('.duurBouwWaarschuwing'); // Corrected selector
            if (parseInt(this.value) > 12) { // Ensure it's parsed as integer
                waarschuwing.style.display = 'block';
            } else {
                waarschuwing.style.display = 'none';
            }
    });
        // --- FUNCTIES VOOR STAP 1 & UBO ---
        function toggleAanvragerType(type) {
            const zakelijkContainer = document.getElementById('zakelijkFieldsContainer');
            const particulierContainer = document.getElementById('particulierFieldsContainer');
            const uboSectieStap1 = document.getElementById('uboSectieStap1');
            
            const zakelijkFieldsQuery = zakelijkContainer.querySelectorAll('input:not([id^="ubo"]), select:not([id^="ubo"]), textarea:not([id^="ubo"])'); // Exclusief UBO velden hier
            const particulierFieldsQuery = particulierContainer.querySelectorAll('input, select, textarea');

            if (type === 'zakelijk') {
                zakelijkContainer.style.display = 'block';
                particulierContainer.style.display = 'none';
                setFieldsRequired(zakelijkFieldsQuery, true);
                setFieldsRequired(particulierFieldsQuery, false);
                checkRechtsvormForUbo(); // Controleer direct of UBO getoond moet worden
            } else if (type === 'particulier') {
                zakelijkContainer.style.display = 'none';
                particulierContainer.style.display = 'block';
                setFieldsRequired(zakelijkFieldsQuery, false);
                setFieldsRequired(particulierFieldsQuery, true);
                if (uboSectieStap1) uboSectieStap1.style.display = 'none'; // Verberg UBO sectie expliciet
                setFieldsRequiredForUBOSectie(false); // Deactiveer alle UBO velden
            } else { 
                zakelijkContainer.style.display = 'none';
                particulierContainer.style.display = 'none';
                if (uboSectieStap1) uboSectieStap1.style.display = 'none';
                setFieldsRequired(zakelijkFieldsQuery, false);
                setFieldsRequired(particulierFieldsQuery, false);
                setFieldsRequiredForUBOSectie(false);
            }
            toggleBtwField(type); // Call to show/hide BTW field
            // saveFormData(); // VERWIJDERD VOOR HANDMATIG OPSLAAN
        }

        function checkRechtsvormForUbo() {
            const rechtsvormSelect = document.getElementById('rechtsvorm');
            const uboSectieStap1 = document.getElementById('uboSectieStap1');
            if (!rechtsvormSelect || !uboSectieStap1 || document.getElementById('aanvragerTypeParticulier').checked) {
                if (uboSectieStap1) uboSectieStap1.style.display = 'none';
                setFieldsRequiredForUBOSectie(false);
                return;
            }

            const gekozenRechtsvorm = rechtsvormSelect.value;
            // Definieer rechtsvormen die UBO-plichtig zijn. Voorbeeld: Eenmanszaak niet.
            const uboPlichtigeRechtsvormen = ['bv', 'vof', 'nv', 'cv', 'maatschap', 'stichting', 'vereniging', 'anders']; 

            if (uboPlichtigeRechtsvormen.includes(gekozenRechtsvorm)) {
                uboSectieStap1.style.display = 'block';
                setFieldsRequiredForUBOSectie(true);
            } else {
                uboSectieStap1.style.display = 'none';
                setFieldsRequiredForUBOSectie(false);
            }
            // saveFormData(); // VERWIJDERD VOOR HANDMATIG OPSLAAN
        }

        function setFieldsRequired(fields, required) {
            fields.forEach(field => {
                let isMarkedAsRequired = false;
                const label = document.querySelector(`label[for="${field.id}"]`);
                if (label && label.querySelector('.asterisk')) {
                    isMarkedAsRequired = true;
                }
                if (field.type === 'radio') {
                    const radioGroup = field.closest('.form-group');
                    const groupLabel = radioGroup.querySelector('label:not(.radio-label)');
                     if (groupLabel && groupLabel.querySelector('.asterisk')) {
                        isMarkedAsRequired = true;
                    }
                }

                if (required && isMarkedAsRequired) {
                    field.required = true;
                    // field.disabled = false; // Wordt hieronder afgehandeld
                } else {
                    field.required = false;
                }
                 // Enable/disable logic based on container visibility primarily
                const zakelijkContainer = document.getElementById('zakelijkFieldsContainer');
                const particulierContainer = document.getElementById('particulierFieldsContainer');
                
                const zakelijkVisible = zakelijkContainer && zakelijkContainer.style.display === 'block';
                const particulierVisible = particulierContainer && particulierContainer.style.display === 'block';

                if (field.closest('#zakelijkFieldsContainer')) {
                    field.disabled = !zakelijkVisible;
                } else if (field.closest('#particulierFieldsContainer')) {
                    field.disabled = !particulierVisible;
                } else { // Fields not in zakelijk/particulier containers (should not happen for these queries)
                    field.disabled = !required; // Fallback: disable if not broadly required
                }
                // If a field is required (because its section is active AND it's marked with an asterisk), ensure it's enabled.
                if (field.required) {
                    field.disabled = false;
                }
            });
        }


        function setFieldsRequiredForUBOSectie(makeRequired) {
            const uboContainer = document.getElementById('ubo-forms-container');
            if (!uboContainer) return;

            const uboVelden = uboContainer.querySelectorAll('input, select, textarea');
            uboVelden.forEach(field => {
                let isMarkedAsRequired = false;
                const label = field.closest('.form-group, .form-row')?.querySelector(`label[for="${field.id}"]`);
                if (label && label.querySelector('.asterisk')) {
                    isMarkedAsRequired = true;
                }
                if (field.type === 'radio' && field.name.startsWith('ubo') && field.name.endsWith('_type')) {
                     isMarkedAsRequired = true; 
                }


                if (makeRequired && isMarkedAsRequired) {
                    field.required = true;
                    field.disabled = false;
                } else {
                    field.required = false;
                    field.disabled = !makeRequired; 
                    if (!makeRequired) { 
                        if (field.type === 'radio' || field.type === 'checkbox') field.checked = false;
                        else if (field.tagName === 'SELECT') field.selectedIndex = 0;
                        else if (field.type !== 'button') field.value = '';
                    }
                }
                 if (makeRequired && !isMarkedAsRequired) { 
                    field.disabled = false;
                 }
            });
        }

        function UBOtoevoegen() {
            const uboSectieStap1 = document.getElementById('uboSectieStap1');
            if (!uboSectieStap1 || uboSectieStap1.style.display === 'none') {
                return;
            }

            const uboContainer = document.getElementById('ubo-forms-container');
            if (!uboContainer) {
                console.error('Container element met id "ubo-forms-container" niet gevonden!');
                return;
            }
            const existingUbos = uboContainer.querySelectorAll('.ubo-section');
            const nextUboNumber = existingUbos.length + 1;
    
            if (nextUboNumber > 10) {
                alert("Je kunt maximaal 10 UBO-secties toevoegen.");
                return;
            }
    
            const templateHtml = `
                <div class="ubo-section" data-ubo-index="${nextUboNumber}">
                    <h4>UBO ${nextUboNumber} / Statutair Bestuurder ${nextUboNumber}</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ubo${nextUboNumber}_voornamen">Volledige voornamen<span class="asterisk"></span></label>
                            <input type="text" id="ubo${nextUboNumber}_voornamen" name="ubo${nextUboNumber}_voornamen">
                        </div>
                        <div class="form-group" style="flex: 0.5;">
                            <label for="ubo${nextUboNumber}_tussenvoegsel">Tussenvoegsel(s)</label>
                            <input type="text" id="ubo${nextUboNumber}_tussenvoegsel" name="ubo${nextUboNumber}_tussenvoegsel">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ubo${nextUboNumber}_achternaam">Eigen achternaam<span class="asterisk"></span></label>
                        <input type="text" id="ubo${nextUboNumber}_achternaam" name="ubo${nextUboNumber}_achternaam">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="ubo${nextUboNumber}_geboortedatum">Geboortedatum<span class="asterisk"></span></label>
                            <input type="date" id="ubo${nextUboNumber}_geboortedatum" name="ubo${nextUboNumber}_geboortedatum">
                        </div>
                        <div class="form-group">
                            <label for="ubo${nextUboNumber}_woonland">Woonland<span class="asterisk"></span></label>
                            <input type="text" id="ubo${nextUboNumber}_woonland" name="ubo${nextUboNumber}_woonland">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Type UBO<span class="asterisk">*</span></label>
                        <div class="radio-group">
                            <div><input type="radio" id="ubo${nextUboNumber}_type_eigendom" name="ubo${nextUboNumber}_type" value="eigendom"><label for="ubo${nextUboNumber}_type_eigendom" class="radio-label">Op basis van eigendom</label></div>
                            <div><input type="radio" id="ubo${nextUboNumber}_type_zeggenschap" name="ubo${nextUboNumber}_type" value="zeggenschap"><label for="ubo${nextUboNumber}_type_zeggenschap" class="radio-label">Op basis van zeggenschap</label></div>
                            <div><input type="radio" id="ubo${nextUboNumber}_type_statutair" name="ubo${nextUboNumber}_type" value="statutair"><label for="ubo${nextUboNumber}_type_statutair" class="radio-label">Op basis van (statutair) bestuur</label></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="ubo${nextUboNumber}_adres">Volledige adres<span class="asterisk">*</span></label>
                        <input type="text" id="ubo${nextUboNumber}_adres" name="ubo${nextUboNumber}_adres" placeholder="Straatnaam Huisnr, Postcode Plaats">
                    </div>
                    <button type="button" onclick="verwijderUBO(this)" class="remove-ubo-button">Verwijder UBO ${nextUboNumber}</button>
                </div>
            `;
    
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = templateHtml.trim(); 
            const newUboElement = tempDiv.firstElementChild;
    
            if (nextUboNumber > 1) { 
                const hrSeparator = document.createElement('hr');
                hrSeparator.style.margin = '25px 0';
                hrSeparator.style.borderColor = '#eee'; 
                hrSeparator.classList.add('ubo-separator');
                uboContainer.appendChild(hrSeparator);
            }
    
            uboContainer.appendChild(newUboElement);
            setFieldsRequiredForUBOSectie(true); 
    
            newUboElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            const firstInput = newUboElement.querySelector('input[type="text"], input[type="date"]');
            if (firstInput) {
                 firstInput.focus();
            }
            // saveFormData(); // VERWIJDERD VOOR HANDMATIG OPSLAAN
        }
    
        function verwijderUBO(buttonElement) {
            const uboSection = buttonElement.closest('.ubo-section');
            if (uboSection) {
                if (confirm('Weet je zeker dat je deze UBO wilt verwijderen?')) {
                    const prevElement = uboSection.previousElementSibling;
                    uboSection.remove();
                    if (prevElement && prevElement.tagName === 'HR' && prevElement.classList.contains('ubo-separator')) {
                        prevElement.remove();
                    }
                    hernummerUbos();
                    // saveFormData(); // VERWIJDERD VOOR HANDMATIG OPSLAAN
                }
            }
        }
    
        function hernummerUbos() {
            const uboContainer = document.getElementById('ubo-forms-container');
            if (!uboContainer) return;
            const existingUbos = uboContainer.querySelectorAll('.ubo-section');
            
            existingUbos.forEach((uboElement, index) => {
                const currentNumber = index + 1;
                uboElement.dataset.uboIndex = currentNumber; 

                const h4 = uboElement.querySelector('h4');
                if (h4) {
                    h4.textContent = `UBO ${currentNumber} / Statutair Bestuurder ${currentNumber}`;
                }

                const fields = uboElement.querySelectorAll('[id*="ubo"], [name*="ubo"], [for*="ubo"]');
                const oldPrefixRegex = new RegExp(`ubo\\d+_`, 'g');
                const oldIdNumRegex = new RegExp(`ubo\\d+(_type_eigendom|_type_zeggenschap|_type_statutair)`, 'g'); 
                const newPrefix = `ubo${currentNumber}_`;

                fields.forEach(field => {
                    if (field.id)   field.id = field.id.replace(oldPrefixRegex, newPrefix).replace(oldIdNumRegex, `ubo${currentNumber}$1`);
                    if (field.name) field.name = field.name.replace(oldPrefixRegex, newPrefix);
                    if (field.htmlFor) field.htmlFor = field.htmlFor.replace(oldPrefixRegex, newPrefix).replace(oldIdNumRegex, `ubo${currentNumber}$1`);
                });

                const removeButton = uboElement.querySelector('.remove-ubo-button');
                if (removeButton) {
                     removeButton.textContent = `Verwijder UBO ${currentNumber}`;
                }
            });
            const uboSectieStap1 = document.getElementById('uboSectieStap1');
            if (uboSectieStap1 && uboSectieStap1.style.display === 'block') {
                 setFieldsRequiredForUBOSectie(true);
            }
        }
    
    
        // Header schaduw bij scrollen
        const mainHeader = document.getElementById('mainHeader');
        if (mainHeader) {
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    mainHeader.classList.add('scrolled');
                } else {
                    mainHeader.classList.remove('scrolled');
                }
            });
        }
    
        // JavaScript voor het multi-step formulier
        let currentStep = 0;
        const steps = Array.from(document.querySelectorAll('.form-step'));
        const progressBar = document.getElementById('progressBar');
        const progressLine = document.getElementById('progressLine');
        const stepIndicators = [];

         // Aannemer Functions
         let aannemerCount = 1; 
        function AannemerToevoegen() {
            const container = document.getElementById('aannemer-forms-container');
            if (!container) return;

            const existingAannemers = container.querySelectorAll('.aannemer-section');
            aannemerCount = existingAannemers.length + 1;

            if (aannemerCount > 5) { 
                alert("U kunt maximaal 5 aannemers opgeven.");
                return;
            }

            const newIdPrefix = `aannemer${aannemerCount}_`;
            const newAvbDetailsId = `${newIdPrefix}avbDetails`;

            const newSection = document.createElement('div');
            newSection.classList.add('aannemer-section');
            newSection.dataset.aannemerIndex = aannemerCount; 

            newSection.innerHTML = `
                <h4>Aannemer ${aannemerCount}</h4>
                <div class="form-group">
                    <label for="${newIdPrefix}naam">Naam van de aannemer<span class="asterisk">*</span></label>
                    <input type="text" id="${newIdPrefix}naam" name="${newIdPrefix}naam">
                </div>
                <div class="form-group">
                    <label for="${newIdPrefix}adres">Adresgegevens aannemer<span class="asterisk">*</span></label>
                    <input type="text" id="${newIdPrefix}adres" name="${newIdPrefix}adres" placeholder="Straat Huisnr, Postcode Plaats">
                </div>
                <div class="form-group">
                    <label for="${newIdPrefix}telefoon">Telefoonnummer aannemer</label>
                    <input type="tel" id="${newIdPrefix}telefoon" name="${newIdPrefix}telefoon">
                </div>
                <div class="form-group">
                    <label>Heeft deze aannemer een Bedrijfsaansprakelijkheidsverzekering (AVB)?<span class="asterisk">*</span></label>
                    <div class="radio-group">
                        <div><input type="radio" id="${newIdPrefix}avb_ja" name="${newIdPrefix}avb" value="ja" onclick="toggleConditional('${newAvbDetailsId}', true)"><label for="${newIdPrefix}avb_ja" class="radio-label">Ja</label></div>
                        <div><input type="radio" id="${newIdPrefix}avb_nee" name="${newIdPrefix}avb" value="nee" onclick="toggleConditional('${newAvbDetailsId}', false)" checked><label for="${newIdPrefix}avb_nee" class="radio-label">Nee</label></div>
                    </div>
                </div>
                <div id="${newAvbDetailsId}" class="conditional-section">
                    <div class="form-group">
                        <label for="${newIdPrefix}avb_maatschappij">Bij welke maatschappij?</label>
                        <input type="text" id="${newIdPrefix}avb_maatschappij" name="${newIdPrefix}avb_maatschappij">
                    </div>
                    <div class="form-group">
                        <label for="${newIdPrefix}avb_polisnr">Polisnummer</label>
                        <input type="text" id="${newIdPrefix}avb_polisnr" name="${newIdPrefix}avb_polisnr">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="${newIdPrefix}avb_bedrag">Verzekerd bedrag</label>
                            <div class="input-group"><span class="currency-symbol">€</span><input type="number" id="${newIdPrefix}avb_bedrag" name="${newIdPrefix}avb_bedrag" step="any"></div>
                        </div>
                        <div class="form-group">
                            <label for="${newIdPrefix}avb_eigenrisico">Eigen risico p.g.</label>
                            <div class="input-group"><span class="currency-symbol">€</span><input type="number" id="${newIdPrefix}avb_eigenrisico" name="${newIdPrefix}avb_eigenrisico" step="any"></div>
                        </div>
                    </div>
                </div>
                <button type="button" class="remove-aannemer-button" onclick="verwijderAannemer(this)">Verwijder Aannemer ${aannemerCount}</button>
            `;
            container.appendChild(newSection);
            
            toggleConditional(newAvbDetailsId, false); 
            
            const aannemerContainer = document.getElementById('aannemerDetailsContainer');
            if (aannemerContainer && aannemerContainer.style.display === 'block') {
                setRequiredForAannemerSection(newSection, true);
            } else {
                 setRequiredForAannemerSection(newSection, false); 
            }

            const firstInput = newSection.querySelector('input, select, textarea');
            if (firstInput) firstInput.focus();
            newSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            // saveFormData(); // VERWIJDERD VOOR HANDMATIG OPSLAAN
        }

        function verwijderAannemer(buttonElement) {
            const sectionToRemove = buttonElement.closest('.aannemer-section');
            if (sectionToRemove) {
                sectionToRemove.remove();
                hernummerAannemers();
                // saveFormData(); // VERWIJDERD VOOR HANDMATIG OPSLAAN
            }
        }

        function hernummerAannemers() {
            const container = document.getElementById('aannemer-forms-container');
            if (!container) return;
            const sections = container.querySelectorAll('.aannemer-section');
            aannemerCount = sections.length;

            sections.forEach((section, index) => {
                const newNumber = index + 1;
                const oldPrefixRegex = /aannemer\d+_/g;
                const newPrefix = `aannemer${newNumber}_`;
                const newAvbDetailsId = `${newPrefix}avbDetails`;

                section.dataset.aannemerIndex = newNumber;
                const h4 = section.querySelector('h4');
                if (h4) h4.textContent = `Aannemer ${newNumber}`;

                section.querySelectorAll('[id], [name], [for]').forEach(el => {
                    if (el.id && el.id.match(oldPrefixRegex)) el.id = el.id.replace(oldPrefixRegex, newPrefix);
                    if (el.name && el.name.match(oldPrefixRegex)) el.name = el.name.replace(oldPrefixRegex, newPrefix);
                    if (el.htmlFor && el.htmlFor.match(oldPrefixRegex)) el.htmlFor = el.htmlFor.replace(oldPrefixRegex, newPrefix);
                });
                
                const avbJaRadio = section.querySelector(`input[id^="${newPrefix}avb_ja"]`);
                if (avbJaRadio) avbJaRadio.setAttribute('onclick', `toggleConditional('${newAvbDetailsId}', true)`);
                const avbNeeRadio = section.querySelector(`input[id^="${newPrefix}avb_nee"]`);
                if (avbNeeRadio) avbNeeRadio.setAttribute('onclick', `toggleConditional('${newAvbDetailsId}', false)`);


                const removeButton = section.querySelector('.remove-aannemer-button');
                if (removeButton) removeButton.textContent = `Verwijder Aannemer ${newNumber}`;
            });
            if (sections.length === 0 && document.getElementById('aannemerDetailsContainer')?.style.display === 'block') {
                 AannemerToevoegen(); 
            }
        }

        function setRequiredForAannemerSection(sectionElement, required) {
            const inputs = sectionElement.querySelectorAll('input[name^="aannemer"], select[name^="aannemer"], textarea[name^="aannemer"]');
            inputs.forEach(input => {
                const label = sectionElement.querySelector(`label[for="${input.id}"]`);
                let isMarkedAsRequired = label && label.querySelector('.asterisk');

                // Handle AVB radio group specifically, as it's always required if the aannemer section is active
                if (input.name.endsWith('_avb') && (input.closest('.aannemer-section')?.style.display !== 'none' && document.getElementById('aannemerDetailsContainer')?.style.display === 'block')) {
                    isMarkedAsRequired = true; 
                }


                if (isMarkedAsRequired) {
                    if (required) {
                        input.setAttribute('required', '');
                        input.disabled = false;
                    } else {
                        input.removeAttribute('required');
                        input.disabled = true;
                    }
                } else { 
                     input.disabled = !required; 
                }
                 // Ensure AVB radio specific required attribute is set/removed
                if (input.name.endsWith('_avb')) {
                    if (required && isMarkedAsRequired) input.setAttribute('required', '');
                    else input.removeAttribute('required');
                }
            });
        }
    
        function initializeProgressBar() {
            steps.forEach((step, index) => {
                const stepIndicator = document.createElement('div');
                stepIndicator.classList.add('progress-step');
    
                const stepNumberSpan = document.createElement('span');
                stepNumberSpan.classList.add('step-number');
                stepNumberSpan.textContent = index + 1;
                stepIndicator.appendChild(stepNumberSpan);
    
                const stepName = step.dataset.stepName || `Stap ${index + 1}`;
                const tooltip = document.createElement('span');
                tooltip.classList.add('tooltip-text');
                tooltip.textContent = stepName;
                stepIndicator.appendChild(tooltip);
    
                progressBar.appendChild(stepIndicator);
                stepIndicators.push(stepIndicator);
            });
            updateProgressBar();
        }
    
        function updateProgressBar() {
            stepIndicators.forEach((indicator, index) => {
                indicator.classList.remove('active', 'completed');
                const stepNumberElement = indicator.querySelector('.step-number');
                if (stepNumberElement) stepNumberElement.style.display = 'inline-block';
                indicator.style.backgroundColor = 'var(--progress-step-inactive-bg)';
    
                if (index === currentStep) {
                    indicator.classList.add('active');
                    indicator.style.backgroundColor = 'var(--progress-step-active-bg)';
                }
                if (index < currentStep) {
                    indicator.classList.add('completed');
                    if (stepNumberElement) stepNumberElement.style.display = 'none';
                }
            });
            const progressPercentage = (steps.length > 1) ? (currentStep / (steps.length - 1)) * 100 : 0;
            progressLine.style.width = `${progressPercentage}%`;
        }
    
        function showStep(stepIndex) {
            steps.forEach((step, index) => {
                step.classList.toggle('active', index === stepIndex);
            });
            if (progressBar) {
                 window.scrollTo({ top: progressBar.offsetTop - 20, behavior: 'smooth' });
            }
            updateProgressBar();
        }

        function isFieldEffectivelyVisible(field) {
            if (field.disabled) return false;

            // Check specific conditional containers that control visibility of field groups
            const conditionalParentIds = [
                'zakelijkFieldsContainer', 'particulierFieldsContainer', 'uboSectieStap1',
                'aannemerDetailsContainer', // Main container for all aannemers
                // IDs of conditional sections are handled by .closest('.conditional-section') below
            ];
            for (const id of conditionalParentIds) {
                const container = document.getElementById(id);
                if (container && container.contains(field) && window.getComputedStyle(container).display === 'none') {
                    return false;
                }
            }
            
            const conditionalSection = field.closest('.conditional-section');
            if (conditionalSection && window.getComputedStyle(conditionalSection).display === 'none') {
                return false;
            }

            // For fields within an individual aannemer-section, ensure its parent #aannemerDetailsContainer is also visible
            const aannemerSection = field.closest('.aannemer-section');
            if (aannemerSection) { // No direct display:none check on aannemerSection itself as it's always block if present
                const aannemerContainer = document.getElementById('aannemerDetailsContainer');
                if(aannemerContainer && window.getComputedStyle(aannemerContainer).display === 'none'){
                    return false;
                }
            }
            
            // For inline text inputs like "Anders, namelijk:"
            if (field.classList.contains('inline-text-input') && !field.classList.contains('visible')) {
                return false;
            }
            // For 'anders' input groups tied to select dropdowns
            const parentInputGroup = field.parentElement;
            if (parentInputGroup && parentInputGroup.classList.contains('input-group') && parentInputGroup.id && parentInputGroup.id.startsWith('anders_') && parentInputGroup.id.endsWith('_input')) {
                if (window.getComputedStyle(parentInputGroup).display === 'none') {
                    return false;
                }
            }

            // General visibility check: walk up the DOM tree until the current form-step
            // If any parent up to (but not including) the form-step is display:none, field is not visible.
            let currentElementForDomWalk = field.parentElement;
            while (currentElementForDomWalk && !currentElementForDomWalk.classList.contains('form-step')) {
                if (window.getComputedStyle(currentElementForDomWalk).display === 'none') {
                    return false;
                }
                currentElementForDomWalk = currentElementForDomWalk.parentElement;
            }
            
            // Finally, ensure the form-step itself is the active one
            const fieldStep = field.closest('.form-step');
            if (fieldStep && !fieldStep.classList.contains('active')) {
                 return false;
            }

            return true; // Default to visible if no hiding conditions met
        }
    
        function validateCurrentStep() {
            const currentFieldsInStep = steps[currentStep].querySelectorAll('input:not([type="button"]):not([type="submit"]), select, textarea');
            let allValid = true;
            let firstInvalidFieldToFocus = null;

            currentFieldsInStep.forEach(field => {
                if (!isFieldEffectivelyVisible(field)) {
                    // Reset styling if field is not active for validation
                    field.style.borderColor = 'var(--form-border-color)';
                    if (document.activeElement !== field || field.disabled) field.style.boxShadow = 'none'; // Keep focus style if focused and valid
                    
                    const groupElem = field.closest('.radio-group, .checkbox-group, .form-group');
                    if (groupElem && groupElem.style.getPropertyValue('border').includes('var(--danger-color)')) {
                        groupElem.style.border = 'none'; 
                        groupElem.style.padding = '0';
                    }
                    return; // Skip validation for non-visible/disabled fields
                }

                let currentFieldIsValid = true;
                const groupElement = field.closest('.radio-group') || field.closest('.checkbox-group') || field.closest('.form-group');

                if ((field.type === 'radio' || field.type === 'checkbox') && field.required) {
                    if (field.type === 'radio') {
                        const name = field.name;
                        if (!document.querySelector(`input[name="${name}"]:checked`)) {
                            currentFieldIsValid = false;
                        }
                    } else { // checkbox
                        if (!field.checked) {
                            currentFieldIsValid = false;
                        }
                    }
                } else {
                    // field.checkValidity() checks required, pattern, type, min, max etc. for other elements
                    currentFieldIsValid = field.checkValidity();
                }

                // Apply styling based on validity
                if (!currentFieldIsValid) {
                    allValid = false;
                    if (!firstInvalidFieldToFocus) {
                        firstInvalidFieldToFocus = field;
                    }
                    // Style group for radio/checkbox if the group itself is effectively required
                    if (groupElement && (field.type === 'radio' || field.type === 'checkbox') && field.required) { 
                        groupElement.style.setProperty('border', '1px solid var(--danger-color)', 'important');
                        groupElement.style.padding = '5px';
                        groupElement.style.borderRadius = '4px';
                    } 
                    // Style individual field (non-radio/checkbox) if invalid
                    else if (field.type !== 'radio' && field.type !== 'checkbox') { 
                        field.style.borderColor = 'var(--danger-color)';
                        field.style.boxShadow = '0 0 0 3px rgba(220, 38, 38, 0.25)';
                    }
                } else {
                    // Reset styling for valid fields
                    if (groupElement && (field.type === 'radio' || field.type === 'checkbox') && field.required) {
                        // Only remove border if this specific check makes the group valid or if it was already valid
                        // A more robust check would be to re-validate the whole group.
                        // For now, if a radio in a required group is checked, the group's error style is removed.
                        let groupConsideredValidNow = false;
                        if(field.type === 'radio' && document.querySelector(`input[name="${field.name}"]:checked`)) groupConsideredValidNow = true;
                        if(field.type === 'checkbox' && field.checked) groupConsideredValidNow = true;
                        
                        if(groupConsideredValidNow){
                           groupElement.style.border = 'none';
                           groupElement.style.padding = '0';
                        }
                    } 
                    else if (field.type !== 'radio' && field.type !== 'checkbox') {
                        field.style.borderColor = 'var(--form-border-color)';
                        if (document.activeElement === field) { // Keep focus style if element is focused
                           field.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.25)';
                        } else {
                           field.style.boxShadow = 'none';
                        }
                    }
                }
            });

            if (!allValid && firstInvalidFieldToFocus) {
                let focusTarget = firstInvalidFieldToFocus;
                // For radio/checkbox, generally focusing the element itself is fine as it's part of the group.
                focusTarget.focus({ preventScroll: true }); // preventScroll to let scrollIntoView handle it smoothly
                focusTarget.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' });
            }
            return allValid;
        }
    
    
        function nextStep() {
            if (!validateCurrentStep()) { 
                 alert('Vul alstublieft alle verplichte velden (*) correct in en zorg dat de waarden het juiste formaat hebben.');
                return;
            }
            if (currentStep < steps.length - 1) {
                currentStep++;
                showStep(currentStep);
            }
        }
    
        function prevStep() {
            if (currentStep > 0) {
                // Clear current step's error styling before moving back
                const currentStepErrorFields = steps[currentStep].querySelectorAll('[style*="border-color: var(--danger-color)"], [style*="box-shadow: rgb(220, 38, 38)"]');
                currentStepErrorFields.forEach(field => {
                    field.style.borderColor = 'var(--form-border-color)';
                     if (document.activeElement === field) {
                        field.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.25)';
                     } else {
                        field.style.boxShadow = 'none';
                     }
                });
                const currentStepErrorGroups = steps[currentStep].querySelectorAll('.form-group[style*="border: 1px solid var(--danger-color)"], .radio-group[style*="border: 1px solid var(--danger-color)"], .checkbox-group[style*="border: 1px solid var(--danger-color)"]');
                 currentStepErrorGroups.forEach(group => {
                    group.style.border = 'none';
                    group.style.padding = '0';
                });
    
                currentStep--;
                showStep(currentStep);
            }
        }
    
        function showLinkedText(elementId) {
            const element = document.getElementById(elementId);
            if(element) {
                element.classList.add('visible');
                element.required = true; 
                element.disabled = false;
            }
        }
        function hideLinkedText(elementId) {
             const element = document.getElementById(elementId);
            if(element) {
                element.classList.remove('visible');
                element.value = '';
                element.required = false; 
                element.disabled = true;
            }
        }
    
        function toggleConditional(elementId, show) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.display = show ? 'block' : 'none';
                const childInputs = element.querySelectorAll('input, select, textarea, button');
    
                childInputs.forEach(input => {
                    let isMarkedAsRequired = false;
                    const label = input.closest('.form-group')?.querySelector(`label[for="${input.id}"]`);
                     if (label && label.querySelector('.asterisk')) {
                        isMarkedAsRequired = true;
                    }
                    if (input.type === 'radio') {
                        const groupLabel = input.closest('.form-group')?.querySelector('label:not(.radio-label):not(.checkbox-label)');
                        if (groupLabel && groupLabel.querySelector('.asterisk')) isMarkedAsRequired = true;
                    }
                    // Special case for aannemer AVB radio group if its parent aannemer-section is visible
                    if (input.name && input.name.includes('_avb') && input.closest('.aannemer-section')) {
                         const aannemerSec = input.closest('.aannemer-section');
                         const aannemerContainer = document.getElementById('aannemerDetailsContainer');
                         if(aannemerSec && aannemerContainer && aannemerContainer.style.display === 'block') {
                            isMarkedAsRequired = true; // AVB radios are required if aannemer section is active
                         }
                    }


                    if (!show) { 
                        if (input.type === 'radio' || input.type === 'checkbox') {
                             input.checked = false;
                        } else if (input.tagName === 'SELECT') {
                            input.selectedIndex = 0;
                            if (input.getAttribute('onchange') && input.getAttribute('onchange').includes('toonAndersVeld')) {
                                const targetIdMatch = input.getAttribute('onchange').match(/toonAndersVeld\s*\(\s*this\s*,\s*['"]([^'"]+)['"]\s*,\s*['"]([^'"]+)['"]\s*\)/);
                                if (targetIdMatch && targetIdMatch[1] && targetIdMatch[2]) {
                                    const andersInputVeld = document.getElementById(targetIdMatch[1]);
                                    const andersMessageVeld = document.getElementById(targetIdMatch[2]);
                                    if (andersInputVeld) {
                                        andersInputVeld.style.display = 'none';
                                        const inputFieldInside = andersInputVeld.querySelector('input');
                                        if (inputFieldInside) {
                                            inputFieldInside.value = '';
                                            inputFieldInside.disabled = true;
                                            inputFieldInside.required = false;
                                        }
                                    }
                                    if (andersMessageVeld) {
                                        andersMessageVeld.style.display = 'none';
                                    }
                                }
                            }
                        } else if (input.tagName.toLowerCase() !== 'button') {
                            input.value = '';
                        }
                        
                        input.required = false;
                        input.disabled = true;
    
                        const onclickAttr = input.getAttribute('onclick');
                        if (onclickAttr) {
                            if (onclickAttr.includes('toggleConditional')) {
                                const match = onclickAttr.match(/toggleConditional\s*\(\s*['"]([^'"]+)['"]/);
                                if (match && match[1]) {
                                    toggleConditional(match[1], false); 
                                }
                            }
                            if (onclickAttr.includes('showLinkedText')) {
                                 const match = onclickAttr.match(/showLinkedText\s*\(\s*['"]([^'"]+)['"]/);
                                 if(match && match[1]) hideLinkedText(match[1]);
                            }
                            if (input.id === 'ookOpPalen_nee' && onclickAttr.includes("showLinkedText('andereFunderingswijze')")) {
                                hideLinkedText('andereFunderingswijze'); 
                            }
                        }
                    } else { // Showing the conditional section
                        input.disabled = false;
                        if (isMarkedAsRequired) {
                            input.required = true;
                        }
                        // If a radio inside this now-shown section was already checked (e.g. from saved data),
                        // ensure its own conditional logic is triggered.
                        if (input.checked && input.getAttribute('onclick')) {
                            const onclickAttr = input.getAttribute('onclick');
                             if (onclickAttr.includes('toggleConditional')) {
                                const match = onclickAttr.match(/toggleConditional\s*\(\s*['"]([^'"]+)['"]\s*,\s*(true|false)\s*\)/);
                                if (match && match[1] && match[2]) {
                                    // Check if the target of this sub-conditional is NOT the current elementId to prevent recursion on self
                                    if(match[1] !== elementId) {
                                      toggleConditional(match[1], match[2] === 'true'); 
                                    }
                                }
                            }
                            if (onclickAttr.includes('showLinkedText')) {
                                const match = onclickAttr.match(/showLinkedText\s*\(\s*['"]([^'"]+)['"]/);
                                if(match && match[1]) showLinkedText(match[1]);
                            }
                        }
                    }
                });
            }
        }
    
        function setupRedenLateStartToggle() {
    const ingangsdatumInput = document.getElementById('ingangsdatumVerzekering');
    const gekozenDatumwerkzaamhedenInput = document.getElementById('startWerkzaamheden');
    const redenContainer = document.getElementById('redenLateStartContainer');
    const redenTextarea = document.getElementById('redenLateStart');

    if (!ingangsdatumInput || !gekozenDatumwerkzaamhedenInput || !redenContainer || !redenTextarea) {
        console.error("Een of meer benodigde elementen zijn niet gevonden voor Reden Late Start.");
        return;
    }

    function toggleRedenLateStartVisibility() {
        const gekozenDatumString = ingangsdatumInput.value;
        const gekozenDatumwerkzaamhedenString = gekozenDatumwerkzaamhedenInput.value;

        if (!gekozenDatumString || !gekozenDatumwerkzaamhedenString) { 
            redenContainer.style.display = 'none';
            redenTextarea.required = false;
            redenTextarea.disabled = true;
            return;
        }

        const gekozenDatum = new Date(gekozenDatumString);
        const datumWerkzaamheden = new Date(gekozenDatumwerkzaamhedenString);
        
        gekozenDatum.setHours(0,0,0,0);
        datumWerkzaamheden.setHours(0,0,0,0);


        if (datumWerkzaamheden < gekozenDatum) { 
            redenContainer.style.display = 'block';
            redenTextarea.required = true; 
            redenTextarea.disabled = false;
        } else {
            redenContainer.style.display = 'none';
            redenTextarea.required = false;
            redenTextarea.disabled = true;
            redenTextarea.value = ''; 
        }
    }
    ingangsdatumInput.addEventListener('change', toggleRedenLateStartVisibility);
    ingangsdatumInput.addEventListener('input', toggleRedenLateStartVisibility);
    gekozenDatumwerkzaamhedenInput.addEventListener('change', toggleRedenLateStartVisibility);
    gekozenDatumwerkzaamhedenInput.addEventListener('input', toggleRedenLateStartVisibility);
    
    toggleRedenLateStartVisibility(); 
}
        const FORM_STORAGE_KEY = 'carOfferteFormData';
        const formElement = document.getElementById('carOfferteForm');

        function saveFormData() {
            if (!formElement) return;
            const formData = new FormData(formElement);
            const data = {};
            let maxUboIndex = 0;
            let maxAannemerIndex = 0;

            formData.forEach((value, key) => {
                if (key.endsWith('[]')) {
                    const realKey = key.slice(0, -2);
                    if (!data[realKey]) {
                        data[realKey] = [];
                    }
                    data[realKey].push(value);
                } else {
                    data[key] = value;
                }

                if (key.startsWith('ubo') && key.includes('_voornamen')) { 
                    const match = key.match(/^ubo(\d+)_/);
                    if (match && parseInt(match[1]) > maxUboIndex) {
                        maxUboIndex = parseInt(match[1]);
                    }
                }
                if (key.startsWith('aannemer') && key.includes('_naam')) { 
                    const match = key.match(/^aannemer(\d+)_/);
                    if (match && parseInt(match[1]) > maxAannemerIndex) {
                        maxAannemerIndex = parseInt(match[1]);
                    }
                }
            });
            data._maxUboIndex = maxUboIndex > 0 ? maxUboIndex : (document.querySelectorAll('#ubo-forms-container .ubo-section').length);
            data._maxAannemerIndex = maxAannemerIndex > 0 ? maxAannemerIndex : (document.querySelectorAll('#aannemer-forms-container .aannemer-section').length);
            data._currentStep = currentStep; 

            localStorage.setItem(FORM_STORAGE_KEY, JSON.stringify(data));
        }

        // --- START NIEUWE FUNCTIE ---
        function handleSaveButtonClick(buttonElement) {
            saveFormData(); // Roep de bestaande opslagfunctie aan

            // Geef duidelijke feedback aan de gebruiker
            const originalText = buttonElement.textContent;
            buttonElement.disabled = true;
            buttonElement.textContent = 'Opgeslagen!';
            buttonElement.style.backgroundColor = '#28a745'; // Groene succeskleur

            alert('Uw voortgang is opgeslagen in uw browser. U kunt dit venster sluiten en later op hetzelfde apparaat terugkeren om verder te gaan.');

            // Zet de knop na een paar seconden terug naar de originele staat
            setTimeout(() => {
                buttonElement.textContent = originalText;
                buttonElement.disabled = false;
                buttonElement.style.backgroundColor = ''; // Verwijdert de inline stijl, CSS pakt het weer op
            }, 3000);
        }
        // --- EINDE NIEUWE FUNCTIE ---

        function loadFormData() {
            const savedData = localStorage.getItem(FORM_STORAGE_KEY);
            if (!savedData) return;

            const data = JSON.parse(savedData);

            if (data.aanvragerType) {
                const typeRadio = document.getElementById(`aanvragerType${data.aanvragerType.charAt(0).toUpperCase() + data.aanvragerType.slice(1)}`);
                if (typeRadio) typeRadio.checked = true;
            }
            if (data.rechtsvorm) {
                const rechtsvormSelect = document.getElementById('rechtsvorm');
                if (rechtsvormSelect) rechtsvormSelect.value = data.rechtsvorm;
            }
            
             const aanvragerTypeChecked = document.querySelector('input[name="aanvragerType"]:checked');
             if (aanvragerTypeChecked) {
                toggleAanvragerType(aanvragerTypeChecked.value); 
             } else {
                toggleAanvragerType(null);
             }


            if (data._maxUboIndex > 1 && document.getElementById('uboSectieStap1')?.style.display === 'block') {
                for (let i = 1; i < data._maxUboIndex; i++) { 
                    UBOtoevoegen(); 
                }
            }
            if (data._maxAannemerIndex > 1) {
                 const aannemerContainer = document.getElementById('aannemerDetailsContainer');
                 const werkDoorAannemerVal = data.werkDoorAannemer;
                 if (aannemerContainer && (werkDoorAannemerVal === 'geheel' || werkDoorAannemerVal === 'gedeeltelijk')) {
                    for (let i = 1; i < data._maxAannemerIndex; i++) {
                        AannemerToevoegen(); 
                    }
                 }
            }


            for (const key in data) {
                if (data.hasOwnProperty(key)) {
                    if (key === '_maxUboIndex' || key === '_maxAannemerIndex' || key === '_currentStep' || key === 'aanvragerType' || key === 'rechtsvorm') continue;

                    const elements = formElement.elements[key];
                    if (elements) {
                        if (elements.type === 'radio' || (elements.length && elements[0] && elements[0].type === 'radio')) { 
                             const radioToSelect = Array.from(elements.length ? elements : [elements]).find(rb => rb.value === data[key]);
                            if (radioToSelect) {
                                radioToSelect.checked = true;
                            }
                        } else if (elements.type === 'checkbox') {
                            elements.checked = (data[key] === 'on' || data[key] === true || data[key] === elements.value);
                        } else if (elements.length && elements[0] && elements[0].type === 'checkbox' && key.endsWith('Inclusief')) { 
                             const savedArray = data[key] || data[key.slice(0,-2)]; 
                             if (Array.isArray(savedArray)) {
                                Array.from(elements).forEach(checkbox => {
                                    if (savedArray.includes(checkbox.value)) {
                                        checkbox.checked = true;
                                    }
                                });
                             }
                        }
                        else { // Handles text, select-one, textarea, etc.
                            elements.value = data[key];
                        }
                    } else { // For checkbox groups like 'werkSoort[]' or 'aanneemsomInclusief[]'
                        const checkboxGroup = formElement.querySelectorAll(`input[name="${key}[]"]`);
                        if (checkboxGroup.length > 0 && Array.isArray(data[key])) {
                            checkboxGroup.forEach(checkbox => {
                                if (data[key].includes(checkbox.value)) {
                                    checkbox.checked = true;
                                }
                            });
                        }
                    }
                }
            }
            
            if (data._currentStep !== undefined) {
                currentStep = parseInt(data._currentStep, 10) || 0;
            }
        }

        function clearSavedFormData() {
            localStorage.removeItem(FORM_STORAGE_KEY);
            console.log('Saved form data cleared.');
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadFormData(); 
            
            const rechtsvormSelect = document.getElementById('rechtsvorm');
            if (rechtsvormSelect) {
                rechtsvormSelect.addEventListener('change', checkRechtsvormForUbo);
            }

            if(progressBar) {
              initializeProgressBar(); 
            }
            showStep(currentStep); 
    
            setupRedenLateStartToggle(); 
    
            function reapplyInitialConditionals() {
                const aanvragerTypeChecked = document.querySelector('input[name="aanvragerType"]:checked');
                if (aanvragerTypeChecked) {
                    toggleAanvragerType(aanvragerTypeChecked.value); 
                } else {
                    toggleAanvragerType(null);
                }

                setupInitialConditionals('onderhoudstermijnOvereen', 'onderhoudstermijnOvereenDetails', 'onderhoudstermijnMeeVerzekeren', 'onderhoudstermijnDuurDetails');
                
                // For 'werk_anders_ja' checkbox
                const werkAndersCheckbox = document.getElementById('werk_anders_ja');
                if(werkAndersCheckbox) {
                    toggleConditional('werkAndersSpecificatieContainer', werkAndersCheckbox.checked && !werkAndersCheckbox.disabled);
                }


                setupInitialConditionals('bedrijfsschade_meeverzekeren', 'bedrijfsschadeDetails');
                setupInitialConditionals('sloopwerk', 'sloopwerkDetails');
                setupInitialConditionals('bemaling', 'bemalingDetails');
                setupInitialConditionals('gravenNabijFundering', 'gravenNabijFunderingDetails');
                setupInitialConditionals('paalfundering', 'paalfunderingDetails');
        
                const paalfunderingDetails = document.getElementById('paalfunderingDetails');
                if (paalfunderingDetails && paalfunderingDetails.style.display === 'block') {
                    setupInitialConditionals('bouwwerkenBinnen15m', 'bouwwerkenBinnen15mDetails');
        
                    const bouwwerkenBinnen15mDetails = document.getElementById('bouwwerkenBinnen15mDetails');
                    if (bouwwerkenBinnen15mDetails && bouwwerkenBinnen15mDetails.style.display === 'block') {
                        const ookOpPalenRadios = document.getElementsByName('ookOpPalen');
                        let ookOpPalenCheckedValue = null;
                        ookOpPalenRadios.forEach(r => { if(r.checked && !r.disabled) ookOpPalenCheckedValue = r.value; });
                        const showAndereFunderingswijze = ookOpPalenCheckedValue === 'nee';
                        toggleConditional('andereFunderingswijzeDetails', showAndereFunderingswijze);
                        if (showAndereFunderingswijze) {
                            showLinkedText('andereFunderingswijze');
                        } else {
                            hideLinkedText('andereFunderingswijze');
                        }
                    } else {
                         toggleConditional('andereFunderingswijzeDetails', false);
                         hideLinkedText('andereFunderingswijze');
                    }
                } else {
                    toggleConditional('bouwwerkenBinnen15mDetails', false);
                    toggleConditional('andereFunderingswijzeDetails', false);
                    hideLinkedText('andereFunderingswijze');
                }
        
        
                setupInitialConditionals('grondkering', 'grondkeringDetails');
                setupInitialConditionals('arbeidsloon_meeverzekeren', 'arbeidsloonDetails');
        
                const werkDoorAannemerChecked = document.querySelector('input[name="werkDoorAannemer"]:checked:not(:disabled)');
                if(werkDoorAannemerChecked){
                    const showAannemerDetails = werkDoorAannemerChecked.value === 'geheel' || werkDoorAannemerChecked.value === 'gedeeltelijk';
                    toggleConditional('aannemerDetailsContainer', showAannemerDetails); 
                    toggleConditional('aannemerDetailopmerking', werkDoorAannemerChecked.value === 'nee');

                    if(showAannemerDetails){
                        document.querySelectorAll('.aannemer-section').forEach(section => {
                            const index = section.dataset.aannemerIndex;
                            const avbRadioCheckedJa = section.querySelector(`input[name="aannemer${index}_avb"][value="ja"]:checked:not(:disabled)`);
                            toggleConditional(`aannemer${index}_avbDetails`, !!avbRadioCheckedJa);
                             setRequiredForAannemerSection(section, true); 
                        });
                    } else {
                        document.querySelectorAll('.aannemer-section').forEach(section => {
                            const index = section.dataset.aannemerIndex;
                            toggleConditional(`aannemer${index}_avbDetails`, false);
                            setRequiredForAannemerSection(section, false); 
                        });
                    }
                } else {
                    toggleConditional('aannemerDetailsContainer', false); 
                    toggleConditional('aannemerDetailopmerking', false);
                     document.querySelectorAll('.aannemer-section').forEach(section => {
                        const index = section.dataset.aannemerIndex;
                        toggleConditional(`aannemer${index}_avbDetails`, false);
                        setRequiredForAannemerSection(section, false);
                    });
                }
        
                setupInitialConditionals('elders_ondergebracht', 'eldersOndergebrachtDetails');
        
                document.querySelectorAll('.inline-text-input').forEach(textField => {
                    if (textField.disabled && textField.id !== 'aardGebouwAndersText' && textField.id !== 'andereFunderingswijze') return; 
                    const radioId = textField.id.replace('Text', 'Radio'); // e.g., aardGebouwAndersText -> aardGebouwAndersRadio
                    const linkedRadio = document.getElementById(radioId);
                    if (linkedRadio && linkedRadio.checked && !linkedRadio.disabled) {
                        textField.classList.add('visible');
                        textField.disabled = false;
                        textField.required = true; 
                    } else {
                        // For 'aardGebouwAndersText', ensure it's hidden if its radio is not checked
                        if (textField.id === 'aardGebouwAndersText' && (!linkedRadio || !linkedRadio.checked) ) {
                             textField.classList.remove('visible');
                             textField.required = false;
                             textField.disabled = true;
                        }
                        // For 'andereFunderingswijze', its visibility is handled by 'ookOpPalen_nee' logic more directly.
                        // Only ensure it's not required/disabled if its controlling radio makes it hidden.
                        if (textField.id === 'andereFunderingswijze') {
                            const ookOpPalenNee = document.getElementById('ookOpPalen_nee');
                            if (!ookOpPalenNee || !ookOpPalenNee.checked || ookOpPalenNee.disabled) {
                                textField.classList.remove('visible'); // It might not have 'visible' but this ensures consistency
                                textField.required = false;
                                textField.disabled = true;
                            }
                        }
                    }
                });
        
                document.querySelectorAll('select[onchange*="toonAndersVeld"]').forEach(selectElement => {
                    if (selectElement.disabled) return; 
                    const targetIdMatch = selectElement.getAttribute('onchange').match(/toonAndersVeld\s*\(\s*this\s*,\s*['"]([^'"]+)['"]\s*,\s*['"]([^'"]+)['"]\s*\)/);
                    if (targetIdMatch && targetIdMatch[1] && targetIdMatch[2]) {
                        toonAndersVeld(selectElement, targetIdMatch[1], targetIdMatch[2]); 
                    }
                });
                const duurBouwInput = document.getElementById('duurBouwMaanden');
                if (duurBouwInput && !duurBouwInput.disabled) { // Check disabled state
                    const event = new Event('input', { bubbles: true });
                    duurBouwInput.dispatchEvent(event);
                }
            }

            reapplyInitialConditionals(); 

            // VERWIJDERD:
            // formElement.addEventListener('input', saveFormData);
            // formElement.addEventListener('change', saveFormData); 
        });
    
        function toonAndersVeld(selectElement, targetInputElementId, targetMessageElementId) {
            var selectedValue = selectElement.value;
            var targetInputElement = document.getElementById(targetInputElementId);
            var targetMessageElement = document.getElementById(targetMessageElementId); 
    
            if (targetInputElement && targetMessageElement) { 
                const inputInside = targetInputElement.querySelector('input[type="number"], input[type="text"]');
                if (selectedValue && selectedValue.toLowerCase() === 'anders') {
                    targetInputElement.style.display = 'flex'; // For input-group
                    targetMessageElement.style.display = 'block'; 
                    if (inputInside) {
                        inputInside.disabled = false;
                        inputInside.required = true; 
                    }
                } else {
                    targetInputElement.style.display = 'none';
                    targetMessageElement.style.display = 'none'; 
                    if (inputInside) {
                        inputInside.value = '';
                        inputInside.disabled = true;
                        inputInside.required = false; 
                    }
                }
            }
        }
        
        function setupInitialConditionals(radioOrCheckboxName, detailsId, subRadioName, subDetailsId) {
            const mainControl = document.querySelector(`input[name="${radioOrCheckboxName}"]:checked:not(:disabled)`) || document.getElementById(radioOrCheckboxName + '_ja'); // for checkbox case
            
            if (mainControl) {
                let showMainDetails = false;
                if (mainControl.type === 'radio') {
                    showMainDetails = mainControl.value === 'ja';
                } else if (mainControl.type === 'checkbox') {
                    showMainDetails = mainControl.checked; // e.g. werk_anders_ja
                }

                toggleConditional(detailsId, showMainDetails);

                if (subRadioName && subDetailsId && showMainDetails) {
                    const subControl = document.querySelector(`input[name="${subRadioName}"]:checked:not(:disabled)`);
                    if (subControl) {
                        toggleConditional(subDetailsId, subControl.value === 'ja');
                    } else {
                        toggleConditional(subDetailsId, false); 
                    }
                } else if (subDetailsId) {
                     toggleConditional(subDetailsId, false); 
                }
            } else {
                toggleConditional(detailsId, false);
                if (subDetailsId) toggleConditional(subDetailsId, false);
            }
        }

        </script>
        <script>
            function autoFillFormForTesting() {
                function _toggleConditional(elementId, show) { if (typeof toggleConditional === "function") toggleConditional(elementId, show); }
                function _toonAndersVeld(selectElementOrId, targetInputElementId, targetMessageElementId) { if (typeof toonAndersVeld === "function") { let el = typeof selectElementOrId === 'string' ? document.getElementById(selectElementOrId) : selectElementOrId; if (el) toonAndersVeld(el, targetInputElementId, targetMessageElementId); } }
                function _showLinkedText(elementId) { if (typeof showLinkedText === "function") showLinkedText(elementId); }
                function _hideLinkedText(elementId) { if (typeof hideLinkedText === "function") hideLinkedText(elementId); }
                function _toggleAanvragerType(type) { if (typeof toggleAanvragerType === "function") toggleAanvragerType(type); }
                function _checkRechtsvormForUbo() { if (typeof checkRechtsvormForUbo === "function") checkRechtsvormForUbo(); }
                function _UBOtoevoegen() { if (typeof UBOtoevoegen === "function") UBOtoevoegen(); }
        
                // --- Stap 1: Aanvragergegevens ---
                document.getElementById('aanvragerTypeZakelijk').checked = true;
                _toggleAanvragerType('zakelijk'); 

                document.getElementById('kvkNummer').value = '87654321';
                document.getElementById('bedrijfsnaamZakelijk').value = 'Autofill Solutions BV';
                document.getElementById('handelsnaamZakelijk').value = 'AS BV';
                document.getElementById('rechtsvorm').value = 'bv'; 
                _checkRechtsvormForUbo(); 

                if (document.getElementById('uboSectieStap1')?.style.display === 'block') {
                    document.getElementById('ubo1_voornamen').value = 'Udo B. Owner';
                    document.getElementById('ubo1_achternaam').value = 'Voorbeeld';
                    document.getElementById('ubo1_geboortedatum').value = '1980-01-01';
                    document.getElementById('ubo1_woonland').value = 'Nederland';
                    const ubo1Type = document.getElementById('ubo1_type_eigendom');
                    if (ubo1Type) ubo1Type.checked = true;
                    document.getElementById('ubo1_adres').value = 'Ubolaan 10, 9876 UB Ubostad';
                }
                
                document.getElementById('straatHuisnrZakelijk').value = 'Testlaan 100';
                document.getElementById('postcodeZakelijkApart').value = '1234AB'; // Correct pattern
                document.getElementById('plaatsZakelijk').value = 'Testdorp';

                document.getElementById('telefoonnummerZakelijk').value = '0612345678';
                document.getElementById('emailadresZakelijk').value = 'info@autofillsolutions.test';
        
                // --- Stap 2: Werkdetails ---
                const vandaag = new Date();
                const startWerkzaamhedenDatum = new Date(vandaag);
                startWerkzaamhedenDatum.setDate(vandaag.getDate() - 2); // Werkzaamheden 2 dagen geleden gestart
                document.getElementById('startWerkzaamheden').value = startWerkzaamhedenDatum.toISOString().split('T')[0];

                const ingangsdatumVerzekeringDatum = new Date(vandaag); // Verzekering vandaag ingaand
                document.getElementById('ingangsdatumVerzekering').value = ingangsdatumVerzekeringDatum.toISOString().split('T')[0];
                
                // Trigger change/input events for date fields to update conditional logic
                ['startWerkzaamheden', 'ingangsdatumVerzekering'].forEach(id => {
                    const el = document.getElementById(id);
                    if(el) {
                        el.dispatchEvent(new Event('input', { bubbles: true })); // For setupRedenLateStartToggle
                        el.dispatchEvent(new Event('change', { bubbles: true }));// For setupRedenLateStartToggle
                    }
                });

                // Fill redenLateStart if visible (it should be, based on above dates)
                const redenLateStartContainer = document.getElementById('redenLateStartContainer');
                if (redenLateStartContainer && redenLateStartContainer.style.display === 'block') {
                    document.getElementById('redenLateStart').value = 'Autofill test: werkzaamheden reeds gestart.';
                }

                document.getElementById('duurBouwMaanden').value = '13'; 
                document.getElementById('duurBouwMaanden').dispatchEvent(new Event('input', { bubbles: true }));


                document.getElementById('werk_nieuwbouw_woning_ja').checked = true;
                document.getElementById('werk_verbouw_bedrijf_ja').checked = true;
                document.getElementById('werk_anders_ja').checked = true; 
                _toggleConditional('werkAndersSpecificatieContainer', true); 
                if(document.getElementById('werk_anders_specificatie')) document.getElementById('werk_anders_specificatie').value = "Speciale testwerkzaamheden";

        
                document.getElementById('onderhoudstermijnOvereen_ja').checked = true; _toggleConditional('onderhoudstermijnOvereenDetails', true);
                document.getElementById('onderhoudstermijnMeeVerzekeren_ja').checked = true; _toggleConditional('onderhoudstermijnDuurDetails', true);
                document.getElementById('duurOnderhoud_12').checked = true;
        
                document.getElementById('aanneemsom').value = '1250000';
                document.getElementById('btw_exclusief').checked = true;
                document.getElementById('inc_toezicht').checked = true;
        
                // --- Stap 3: Verzekerde Sommen & Risico's ---
                const aansprakelijkheidSelect = document.querySelector('select[name="aansprakelijkheid_som"]');
                if (aansprakelijkheidSelect) aansprakelijkheidSelect.value = '2500000';
                
                document.getElementById('bestaande_eigendommen_som').value = 'Anders'; 
                _toonAndersVeld(document.getElementById('bestaande_eigendommen_som'), 'anders_bestaand_eigendommen_input', 'anders_bestaand_eigendommen_message');
                const andersBestaandEigendom = document.querySelector('input[name="bestaande_eigendommen_som_anders_val"]');
                if(andersBestaandEigendom) andersBestaandEigendom.value = "300000";

                document.getElementById('Hulpmateriaal').value = '125000'; 
                _toonAndersVeld(document.getElementById('Hulpmateriaal'), 'anders_Hulpmateriaal_input', 'anders_Hulpmateriaal_message');
        
                document.getElementById('Eigen_risico').value = '5000'; 
                _toonAndersVeld(document.getElementById('Eigen_risico'), 'anders_Eigen_risico_input', 'anders_Eigen_risico_message');
        
                document.getElementById('bedrijfsschade_ja').checked = true; _toggleConditional('bedrijfsschadeDetails', true);
                if(document.getElementById('bedrijfsschade_belang')) document.getElementById('bedrijfsschade_belang').value = "150000";
                if(document.getElementById('bedrijfsschade_uitkeringstermijn')) document.getElementById('bedrijfsschade_uitkeringstermijn').value = "26";
        
                // --- Stap 4: Constructiedetails ---
                document.getElementById('locatieWerk').value = 'Industrieterrein Noord, Teststad';
                document.getElementById('aardGebouw_steen').checked = true; _hideLinkedText('aardGebouwAndersText');
        
                document.getElementById('sloopwerk_ja').checked = true; _toggleConditional('sloopwerkDetails', true);
                    if(document.getElementById('sloopwerk_constructies')) document.getElementById('sloopwerk_constructies').value = "Dragende binnenmuur en deel van gevel.";
                    const sloopadviesJa = document.querySelector('input[name="sloopadvies"][value="ja"]');
                    if(sloopadviesJa) sloopadviesJa.checked = true;

                document.getElementById('bemaling_ja').checked = true; _toggleConditional('bemalingDetails', true);
                    const bemalingsadviesJa = document.querySelector('input[name="bemalingsadvies"][value="ja"]');
                    if(bemalingsadviesJa) bemalingsadviesJa.checked = true;

                document.getElementById('gravenNabijFundering_ja').checked = true; _toggleConditional('gravenNabijFunderingDetails', true);
                    const uitvoeringsplanGravenJa = document.querySelector('input[name="uitvoeringsplanGraven"][value="ja"]');
                    if(uitvoeringsplanGravenJa) uitvoeringsplanGravenJa.checked = true;

                document.getElementById('kelderZwembad_ja').checked = true;
        
                document.getElementById('paalfundering_ja').checked = true; _toggleConditional('paalfunderingDetails', true);
                    const funderingsadviesPaalJa = document.querySelector('input[name="funderingsadviesPaal"][value="ja"]');
                    if (funderingsadviesPaalJa) funderingsadviesPaalJa.checked = true;
                    const paalsysteemGedrukt = document.querySelector('input[name="paalsysteem"][value="gedrukt"]');
                    if (paalsysteemGedrukt) paalsysteemGedrukt.checked = true;
                    document.getElementById('bouwwerkenBinnen15m_ja').checked = true; _toggleConditional('bouwwerkenBinnen15mDetails', true);
                        const eigenaarAnderen = document.querySelector('input[name="eigenaarBouwwerk"][value="anderen"]');
                        if (eigenaarAnderen) eigenaarAnderen.checked = true;
                        document.getElementById('afstandDichtstbijzijndeBouwwerk').value = '5.5';
                        document.getElementById('ookOpPalen_nee').checked = true; 
                            _toggleConditional('andereFunderingswijzeDetails', true); 
                            _showLinkedText('andereFunderingswijze');
                        if(document.getElementById('andereFunderingswijze')) document.getElementById('andereFunderingswijze').value = "Op staal gefundeerd";
        
                document.getElementById('grondkering_ja').checked = true; _toggleConditional('grondkeringDetails', true);
                    const adviesGrondkeringJa = document.querySelector('input[name="adviesGrondkering"][value="ja"]');
                    if(adviesGrondkeringJa) adviesGrondkeringJa.checked = true;
                document.getElementById('funderingsherstel_ja').checked = true;
        
                // --- Stap 5: Uitvoering & Aannemer ---
                document.getElementById('arbeidsloon_ja').checked = true; _toggleConditional('arbeidsloonDetails', true);
                if(document.getElementById('arbeidsloon_som')) document.getElementById('arbeidsloon_som').value = "50000";
        
                document.getElementById('werkDoorAannemer_gedeeltelijk').checked = true;
                _toggleConditional('aannemerDetailsContainer', true); 
                _toggleConditional('aannemerDetailopmerking', false); 
        
                    document.getElementById('aannemer1_naam').value = 'TopBouw Nederland';
                    document.getElementById('aannemer1_adres').value = 'Constructieweg 10, 7890 CD Bouwdorp';
                    document.getElementById('aannemer1_telefoon').value = '0501234567';
                    document.getElementById('aannemer1_avb_ja').checked = true; _toggleConditional('aannemer1_avbDetails', true);
                        document.getElementById('aannemer1_avb_maatschappij').value = 'GarantVerzekeringen';
                        document.getElementById('aannemer1_avb_polisnr').value = 'GV-AVB-998877';
                        document.getElementById('aannemer1_avb_bedrag').value = '2500000';
                        document.getElementById('aannemer1_avb_eigenrisico').value = '1000';
                document.getElementById('overige_opmerkingen_beoordeling').value = 'Autofill test - complexe situatie.';
        
                // --- Stap 6: Afronding ---
                document.getElementById('elders_ondergebracht_ja').checked = true; _toggleConditional('eldersOndergebrachtDetails', true);
                if(document.getElementById('vorige_maatschappij')) document.getElementById('vorige_maatschappij').value = "Oude Polis NV";
                if(document.getElementById('vorige_polisnummer')) document.getElementById('vorige_polisnummer').value = "OP-12345";
                if(document.getElementById('vorige_afloopdatum')) {
                    const afloopDatum = new Date();
                    afloopDatum.setDate(afloopDatum.getDate() - 30);
                    document.getElementById('vorige_afloopdatum').value = afloopDatum.toISOString().split('T')[0];
                }
        
                if (typeof saveFormData === "function") {
                    saveFormData();
                }
                // Call reapplyInitialConditionals AFTER all values are set to ensure correct state
                if (typeof reapplyInitialConditionals === "function") { 
                    reapplyInitialConditionals();
                }

                console.log("Formulier automatisch ingevuld voor testen (Zakelijk met UBO).");
                alert("Formulier is automatisch ingevuld (Zakelijk met UBO) en opgeslagen in localStorage. Ververs de pagina om te zien of de data geladen wordt, of ga naar de volgende stap en terug om de conditionals te zien.");
            }
        
            document.addEventListener('DOMContentLoaded', function() {
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('autofill') === 'true') {
                    setTimeout(function() {
                        try {
                            autoFillFormForTesting();
                        } catch (e) {
                            console.error("Fout bij automatisch invullen:", e);
                            alert("Fout bij autofill. Check console.");
                        }
                    }, 500); 
                }
            });
        </script>
</body>
</html>
